# NewPennine v1.3.2 æ¸¬è©¦åŸ·è¡Œè¨ˆåŠƒ

## ğŸ“‹ æ¸¬è©¦æ¦‚è¿°

æ­¤æ–‡æª”æä¾› NewPennine v1.3.2 ç‰ˆæœ¬çš„å®Œæ•´æ¸¬è©¦æ–¹æ¡ˆï¼Œç¢ºä¿æ‰€æœ‰æ–°åŠŸèƒ½å’Œä¿®å¾©æ­£å¸¸é‹ä½œã€‚

## ğŸ¯ æ¸¬è©¦ç›®æ¨™

1. **JWT èªè­‰æµç¨‹é©—è­‰** - ç¢ºä¿ç™»å…¥ç³»çµ±æ­£å¸¸é‹ä½œ
2. **NestJS API ç«¯é»æ¸¬è©¦** - é©—è­‰æ‰€æœ‰å¾Œç«¯ API éŸ¿æ‡‰æ­£ç¢º
3. **å‰ç«¯ Widgets åŠŸèƒ½** - ç¢ºä¿å„€è¡¨æ¿çµ„ä»¶æ­£å¸¸é¡¯ç¤ºæ•¸æ“š
4. **å®Œæ•´ç”¨æˆ¶å·¥ä½œæµç¨‹** - é©—è­‰ç«¯åˆ°ç«¯ç”¨æˆ¶é«”é©—

## ğŸ” æ¸¬è©¦æ†‘æ“š

### ç³»çµ±ç™»å…¥è³‡è¨Š
- **Email**: `akwan@pennineindustries.com`
- **Password**: `X315Y316`

## ğŸ§ª æ¸¬è©¦ç’°å¢ƒé…ç½®

### ç’°å¢ƒè¦æ±‚
- Node.js 18+
- PostgreSQL (Supabase)
- Next.js 14
- NestJS 11

### å¿…è¦ç’°å¢ƒè®Šé‡
```env
# å¾Œç«¯ API (.env)
PORT=3001
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
JWT_SECRET=your_jwt_secret
JWT_EXPIRES_IN=1h
SYS_LOGIN=akwan@pennineindustries.com
SYS_PASSWORD=X315Y316
CORS_ORIGIN=http://localhost:3000
NODE_ENV=development

# å‰ç«¯ (.env.local)
NEXT_PUBLIC_API_URL=http://localhost:3001/api/v1
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

## ğŸ“ æ¸¬è©¦åŸ·è¡Œæ­¥é©Ÿ

### 1. æº–å‚™æ¸¬è©¦ç’°å¢ƒ

```bash
# å…‹éš†å€‰åº«
cd /Users/kwanchuncheong/NewPennine/backend/newpennine-api

# å®‰è£ä¾è³´
npm install

# é…ç½®ç’°å¢ƒè®Šé‡
cp .env.example .env
# ç·¨è¼¯ .env æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¢ºçš„é…ç½®

# å®‰è£ Playwright (å¦‚éœ€è¦)
npm install @playwright/test
npx playwright install
```

### 2. å¾Œç«¯ API æ¸¬è©¦

#### 2.1 å–®å…ƒæ¸¬è©¦
```bash
# é‹è¡Œå–®å…ƒæ¸¬è©¦
npm test

# é‹è¡Œè¦†è“‹ç‡æ¸¬è©¦
npm run test:cov
```

#### 2.2 E2E æ¸¬è©¦
```bash
# å•Ÿå‹•å¾Œç«¯æœå‹™å™¨
npm run start:dev

# åœ¨å¦ä¸€å€‹çµ‚ç«¯é‹è¡Œ E2E æ¸¬è©¦
npm run test:e2e

# é‹è¡Œ v1.3.2 å°ˆç”¨æ¸¬è©¦
npm run test:e2e -- test/v1.3.2-validation.e2e-spec.ts
```

### 3. å‰ç«¯æ•´åˆæ¸¬è©¦

#### 3.1 å•Ÿå‹•æœå‹™
```bash
# å•Ÿå‹•å¾Œç«¯ API (çµ‚ç«¯1)
npm run start:dev

# å•Ÿå‹•å‰ç«¯æœå‹™ (çµ‚ç«¯2)
cd ../
npm run dev
```

#### 3.2 é‹è¡Œ Playwright æ¸¬è©¦
```bash
# é‹è¡Œå‰ç«¯æ•´åˆæ¸¬è©¦
npx playwright test

# é‹è¡Œç‰¹å®šæ¸¬è©¦æ–‡ä»¶
npx playwright test test/playwright/widgets-integration.spec.ts

# ä»¥ UI æ¨¡å¼é‹è¡Œ
npx playwright test --ui
```

## ğŸ” è©³ç´°æ¸¬è©¦æ¡ˆä¾‹

### èªè­‰ç³»çµ±æ¸¬è©¦

#### æ¸¬è©¦æ¡ˆä¾‹ 1: ç³»çµ±ç™»å…¥
```javascript
// é æœŸ: æˆåŠŸç™»å…¥ä¸¦ç²å¾— JWT token
POST /api/v1/auth/login
{
  "email": "akwan@pennineindustries.com",
  "password": "X315Y316"
}

// é æœŸéŸ¿æ‡‰: 200 OK
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "email": "akwan@pennineindustries.com",
    "id": "user_id"
  }
}
```

#### æ¸¬è©¦æ¡ˆä¾‹ 2: Token é©—è­‰
```javascript
// é æœŸ: é©—è­‰ token æœ‰æ•ˆæ€§
GET /api/v1/auth/verify
Authorization: Bearer {token}

// é æœŸéŸ¿æ‡‰: 200 OK
{
  "valid": true,
  "user": { ... }
}
```

### API ç«¯é»æ¸¬è©¦

#### æ ¸å¿ƒ Widgets API
1. **çµ±è¨ˆå¡ç‰‡æ•¸æ“š**
   ```bash
   GET /api/v1/widgets/stats-card?dataSource=totalPallets
   GET /api/v1/widgets/stats-card?dataSource=activeTransfers
   GET /api/v1/widgets/stats-card?dataSource=todayGRN
   GET /api/v1/widgets/stats-card?dataSource=pendingOrders
   ```

2. **åº«å­˜åˆ†æ**
   ```bash
   GET /api/v1/widgets/inventory-analysis
   GET /api/v1/widgets/inventory-analysis?warehouse=injection
   ```

3. **ç”¢å“åˆ†ä½ˆ**
   ```bash
   GET /api/v1/widgets/product-distribution
   GET /api/v1/widgets/product-distribution?warehouse=injection&limit=10
   ```

4. **åº«å­˜èˆ‡è¨‚å–®åˆ†æ**
   ```bash
   GET /api/v1/widgets/inventory-ordered-analysis?startDate=2025-01-01&endDate=2025-01-15
   ```

#### åˆ†ææ¨¡çµ„ API
1. **ACO è¨‚å–®é€²åº¦**
   ```bash
   GET /api/v1/analysis/aco-order-progress-cards?startDate=2025-01-01&endDate=2025-01-15
   GET /api/v1/analysis/aco-order-progress-chart?startDate=2025-01-01&endDate=2025-01-15&granularity=daily
   ```

### å‰ç«¯æ¸¬è©¦æ¡ˆä¾‹

#### Widget é¡¯ç¤ºæ¸¬è©¦
1. **çµ±è¨ˆå¡ç‰‡é¡¯ç¤º**
   - æª¢æŸ¥æ•¸å€¼æ­£ç¢ºé¡¯ç¤º
   - é©—è­‰æ¨™ç±¤æ–‡å­—
   - ç¢ºèªæ›´æ–°æ™‚é–“æˆ³

2. **åœ–è¡¨æ¸²æŸ“æ¸¬è©¦**
   - åº«å­˜åˆ†æåœ–è¡¨æ­£å¸¸æ¸²æŸ“
   - ç”¢å“åˆ†ä½ˆåœ“é¤…åœ–é¡¯ç¤º
   - è¨‚å–®é€²åº¦æ™‚é–“ç·šåœ–è¡¨

3. **ç¯©é¸åŠŸèƒ½æ¸¬è©¦**
   - å€‰åº«ç¯©é¸åŠŸèƒ½
   - æ—¥æœŸç¯„åœé¸æ“‡
   - å³æ™‚æ•¸æ“šæ›´æ–°

#### éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦
- æ¡Œé¢ç‰ˆæœ¬ (1920x1080)
- å¹³æ¿ç‰ˆæœ¬ (768x1024)
- æ‰‹æ©Ÿç‰ˆæœ¬ (375x667)

## âš¡ æ€§èƒ½åŸºæº–

### API éŸ¿æ‡‰æ™‚é–“ç›®æ¨™
- å¥åº·æª¢æŸ¥: < 100ms
- çµ±è¨ˆå¡ç‰‡: < 2ç§’
- è¤‡é›œåˆ†ææŸ¥è©¢: < 5ç§’
- æ‰€æœ‰å…¶ä»–ç«¯é»: < 3ç§’

### å‰ç«¯æ€§èƒ½ç›®æ¨™
- é¦–å±æ¸²æŸ“ (FCP): < 2ç§’
- æœ€å¤§å…§å®¹æ¸²æŸ“ (LCP): < 4ç§’
- é¦–æ¬¡è¼¸å…¥å»¶é² (FID): < 100ms
- ç´¯è¨ˆå¸ƒå±€åç§» (CLS): < 0.1

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. èªè­‰å¤±æ•—
```bash
# æª¢æŸ¥ç’°å¢ƒè®Šé‡
echo $JWT_SECRET
echo $SYS_LOGIN
echo $SYS_PASSWORD

# æª¢æŸ¥ Supabase é€£æ¥
curl -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
     "$SUPABASE_URL/rest/v1/auth/users"
```

#### 2. API é€£æ¥éŒ¯èª¤
```bash
# æª¢æŸ¥å¾Œç«¯æœå‹™ç‹€æ…‹
curl http://localhost:3001/api/v1/health

# æª¢æŸ¥æ•¸æ“šåº«é€£æ¥
npm run test:e2e -- test/debug-env.e2e-spec.ts
```

#### 3. å‰ç«¯è¼‰å…¥å•é¡Œ
```bash
# æª¢æŸ¥å‰ç«¯æœå‹™
curl http://localhost:3000

# æª¢æŸ¥ API ä»£ç†è¨­ç½®
curl http://localhost:3000/api/health
```

### æ—¥èªŒæª¢æŸ¥
```bash
# å¾Œç«¯æ—¥èªŒ
npm run start:dev

# æŸ¥çœ‹è©³ç´°éŒ¯èª¤
NODE_ENV=development npm run start:dev

# Playwright æ¸¬è©¦æ—¥èªŒ
npx playwright test --reporter=html
```

## ğŸ“Š æ¸¬è©¦å ±å‘Š

### é‹è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆå ±å‘Š
```bash
# ç”Ÿæˆå®Œæ•´æ¸¬è©¦å ±å‘Š
npm run test:e2e > test-results/e2e-report.txt 2>&1

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:cov

# ç”Ÿæˆ Playwright å ±å‘Š
npx playwright test --reporter=html
```

### å ±å‘Šä½ç½®
- E2E æ¸¬è©¦å ±å‘Š: `test-results/e2e-report.txt`
- è¦†è“‹ç‡å ±å‘Š: `coverage/lcov-report/index.html`
- Playwright å ±å‘Š: `playwright-report/index.html`

## âœ… é©—æ”¶æ¨™æº–

### å¿…é ˆé€šéçš„æ¸¬è©¦
1. âœ… æ‰€æœ‰å¥åº·æª¢æŸ¥ç«¯é»è¿”å› 200
2. âœ… ç³»çµ±æ†‘æ“šç™»å…¥æˆåŠŸ
3. âœ… JWT token é©—è­‰æ­£å¸¸
4. âœ… æ‰€æœ‰ Widget API è¿”å›é æœŸæ•¸æ“šçµæ§‹
5. âœ… å‰ç«¯ widgets æ­£å¸¸é¡¯ç¤º
6. âœ… éŒ¯èª¤è™•ç†æ©Ÿåˆ¶æ­£å¸¸
7. âœ… æ€§èƒ½æŒ‡æ¨™åœ¨ç›®æ¨™ç¯„åœå…§

### å¯é¸é€šéçš„æ¸¬è©¦
- ğŸ“Š æ‰€æœ‰åœ–è¡¨æ¸²æŸ“æ­£å¸¸
- ğŸ›ï¸ ç¯©é¸åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆé©é…æ­£å¸¸
- âš¡ æ‡¶åŠ è¼‰åŠŸèƒ½æ­£å¸¸

## ğŸ”§ æ¸¬è©¦ç¶­è­·

### æ›´æ–°æ¸¬è©¦æ¡ˆä¾‹
1. æ–°å¢åŠŸèƒ½æ™‚ï¼Œæ·»åŠ å°æ‡‰æ¸¬è©¦æ¡ˆä¾‹
2. ä¿®æ”¹ API æ™‚ï¼Œæ›´æ–°ç›¸é—œæ¸¬è©¦
3. å®šæœŸæª¢æŸ¥æ¸¬è©¦æ•¸æ“šæœ‰æ•ˆæ€§

### æ¸¬è©¦æ•¸æ“šç®¡ç†
- ä½¿ç”¨ Supabase æ¸¬è©¦æ•¸æ“šåº«
- å®šæœŸå‚™ä»½æ¸¬è©¦æ•¸æ“š
- ä¿æŒæ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢ç’°å¢ƒåŒæ­¥

---

## ğŸ“ æ”¯æ´

å¦‚é‡åˆ°æ¸¬è©¦å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. ç’°å¢ƒè®Šé‡é…ç½®æ˜¯å¦æ­£ç¢º
2. Supabase é€£æ¥æ˜¯å¦æ­£å¸¸
3. æ‰€æœ‰æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
4. æ¸¬è©¦æ†‘æ“šæ˜¯å¦æœ‰æ•ˆ

**ç‰ˆæœ¬**: v1.3.2  
**æœ€å¾Œæ›´æ–°**: 2025-07-15  
**ç¶­è­·è€…**: NewPennine é–‹ç™¼åœ˜éšŠ