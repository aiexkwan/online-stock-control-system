---
argument-hint: [target_path]
description: 對指定的檔案或組件進行全面的循序深度分析，以生成一份關於其是否可被安全移除的詳盡報告。
---

# 系統檔案清理分析指令

此指令旨在回答一個核心問題：「這個檔案/組件可以被安全地刪除嗎？」它通過一個由總指揮代理主導的、循序的、多層次的深度分析流程，來評估目標檔案的技術債務情況及其在系統中的影響，最終生成一份詳盡的分析報告，但**不執行任何實際的刪除操作**。

## 代理目錄

- [代理目錄](/Users/chun/Documents/PennineWMS/online-stock-control-system/.claude/agents)

## 變數

- **TARGET_PATH**: $ARGUMENTS[0] - 需要分析的檔案、目錄或 glob 模式。

## 核心原則：循序深度分析

- **安全第一**: 指令的唯一目標是分析與報告，絕不修改或刪除任何檔案。
- **循序深入**: 模仿專家的分析流程，從靜態檢查到依賴關係，再到運行時影響，層層遞進。
- **單一職責**: 每次分析只調用一個最合適的專家代理，確保分析的深度和準確性。
- **結論導向**: 所有分析步驟都為最終的「可否刪除」結論提供數據支持。

## 執行流程

**總指揮**: [architect-review](../agents/architect-review.md)

總指揮代理將按以下順序，調度各專家對 `$TARGET_PATH` 進行分析，並將每一步的結果記錄下來，供最終報告使用。

0. 建立報告文檔：`/Users/chun/Documents/PennineWMS/online-stock-control-system/docs/PlanningDocument/clearance_plan/[$ARGUMENTS].md`

1. **第1步：靜態分析 (由 [code-reviewer](../agents/code-reviewer.md) 執行)**
   - **目標**: 檢查檔案本身的屬性，判斷其是否符合已知的「技術債務」特徵。
   - **檢查點**:
     - 是否符合「清理對象識別標準」（如命名包含 `_legacy`, `_bak`）。
     - 是否使用了已被棄用的技術或庫。

2. **第2步：依賴分析 (由 [frontend-developer](../agents/frontend-developer.md) 和 [backend-architect](../agents/backend-architect.md) 協同執行)**
   - **目標**: 追蹤目標檔案在整個代碼庫中的所有引用關係。
   - **檢查點**:
     - 是否有任何直接的 `import` 或 `require` 語句指向該檔案？
     - 是否在任何路由、中間件或配置文件中被引用？
     - GraphQL schema 或 Supabase 遷移中是否存在對此檔案的依賴？

3. **第3步：運行時分析 (由 [test-automator](../agents/test-automator.md) 和 [error-detective](../agents/error-detective.md) 協同執行)**
   - **目標**: 評估檔案在系統實際運行時的潛在影響。
   - **檢查點**:
     - （模擬刪除後）運行相關的單元測試和 E2E 測試，是否會導致失敗？
     - 在生產環境的錯誤日誌中，是否能搜索到對此檔案的引用記錄？

4. **第4步：影響評估 (由 [security-auditor](../agents/security-auditor.md) 和 [performance-engineer](../agents/performance-engineer.md) 協同執行)**
   - **目標**: 綜合所有信息，評估刪除檔案後對非功能性需求的影響。
   - **檢查點**:
     - 該檔案是否包含任何與安全、認證、授權相關的邏輯？
     - 刪除後是否會對應用的 Bundle 大小、加載性能產生正面或負面影響？

5. **第5步：生成分析報告 (由 [docs-architect](../agents/docs-architect.md) 執行)**
   - **目標**: 匯總以上所有分析步驟的結果，根據預設模版，生成一份統一的、詳盡的分析報告。

## 清理對象識別標準

在分析階段，代理應根據以下一個或多個標準，將檔案或組件標記為潛在的清理對象：

- **零引用 (Zero-Reference)**: 檔案在專案中沒有任何有效的 import 或引用。
- **命名約定 (Naming Convention)**: 檔案或目錄名稱包含 `_legacy`, `_bak`, `_old`, `v1`, `archive` 等關鍵字。
- **過時技術 (Outdated Technology)**: 使用了已被官方棄用的函式庫或 API。
- **關聯的功能已下線 (Disabled Feature Association)**: 代碼僅被一個已經下線或永久停用的功能標記 (Feature Flag) 所使用。

## 輸出：清理分析報告

指令的唯一輸出是一份 Markdown 格式的分析報告，嚴格遵循以下模版。

### 清理分析報告模版

```markdown
# 系統清理分析報告

- **分析目標**: `[TARGET_PATH]`
- **分析時間**: `[YYYY-MM-DD HH:MM:SS]`

---

## 最終結論

**[ ✅ 可以安全刪除 | ⚠️ 有風險，不建議刪除 | ❌ 高風險，嚴禁刪除 ]**

### 核心理由

> [對最終結論的簡短總結，例如：此組件在代碼庫中零引用，且相關功能已下線。]

---

## 詳細分析證據

### 1. 靜態分析結果

- **命名/位置符合清理標準**: `[是/否]`
- **使用過時技術**: `[是/否, 如是請說明]`
- **Git 歷史**: `[例如：最後修改於 26 個月前]`
- **靜態分析結論**: `[潛在的技術債務 | 看起來仍在使用]`

### 2. 依賴分析結果

- **直接引用數量**: `[Number]`
- **引用來源**:
  - `[path/to/referencing/file1.ts]`
  - `[path/to/referencing/file2.tsx]`
- **依賴分析結論**: `[零引用 | 被 N 個模組依賴]`

### 3. 運行時分析結果

- **關聯測試結果**: `[通過 | N/A | X 個測試失敗]`
- **錯誤日誌關聯**: `[是/否]`
- **運行時分析結論**: `[移除後無明顯運行時影響 | 移除後將導致測試失敗]`

### 4. 影響評估結果

- **安全影響**: `[無 | 低 | 中 | 高, 請說明]`
- **性能影響**: `[正面 (Bundle -25KB) | 負面 | 無]`
- **影響評估結論**: `[移除後對系統無負面影響 | 移除將影響安全策略]`

---

## 建議後續步驟

- **如果可以刪除**: `建議執行 'git rm [TARGET_PATH]'，並在合併前執行一次完整的 E2E 測試。`
- **如果不建議刪除**: `建議重構此組件，解決其依賴問題，或為其補充單元測試。`
- **如果嚴禁刪除**: `此組件為核心模組，請勿修改。`
```
