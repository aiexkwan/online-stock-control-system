# Final System Audit Command

## 用法
`/final-audit` 或 `/final-audit [系統/模組名稱]`

## 角色建議
- 閱讀 docs\role_play 內的角色文檔
- 主要角色: 🏗️ Architect（整體視角）
- 全面審核: 全部14個角色
- 企業級組合: 核心角色組合建議

## 執行工具
- **思維工具**：Sequential-thinking, Ultrathink, Task
- **搜尋資料**：Brave Search MCP
- **測試工具**：Puppeteer MCP (headless測試)
- **資料庫**：Supabase MCP

## 測試憑證
```yaml
登入憑證:
  email: ${env.local.PUPPETEER_LOGIN}
  password: ${env.local.PUPPETEER_PASSWORD}
```

## 審核內容與目的

### 1. 🔄 Workflow 分析
- 確認所有流程是否符合業務邏輯與 UX 原則
- 避免不一致、多餘、重複步驟或操作

### 2. 📊 Dataflow 檢查
- 是否存在重複讀寫資料或冗餘傳遞
- 是否資料應落在 DB 層卻放在前端邏輯處理
- 有無合理使用 REST API / Server Action / RPC / view 結構提升效能

### 3. 🧼 Code Quality & 清潔度
- 是否符合 DRY / KISS / SoC 原則
- 是否有重複 code / 多版本共存組件未統一
- 檢查是否大量 console.log、暫存測試代碼仍在生產環境

### 4. 🧱 Component 維護性審核
- 檢查是否存在內容相近的新舊組件共存（如 WidgetA_v1 vs WidgetA_v2）
- 是否應合併成統一模組
- 是否有明顯尚未遷移的 legacy 組件（特別是有 size-based UI variant）

### 5. 🌐 UI & 語言一致性
- 所有畫面內容皆使用英文（提示、按鈕、表格 header、註解）

### 6. 🔒 系統安全性
- Supabase Auth、JWT 驗證是否落實
- 是否正確使用 RLS policy 限制資料存取
- 是否有 route-based RBAC / metadata 權限控制
- 錯誤訊息是否防止資訊洩露

### 7. 🧪 測試覆蓋率
- 有無 Unit test / Integration test / E2E test
- 是否整合 CI 工具自動測試（如 Vercel, GitHub Action）
- 是否針對 GraphQL / RPC query 有測試 coverage 報告

### 8. 📈 Logging 與分類
- 是否所有主要行為/錯誤/DB 操作皆有 log
- Log 是否區分等級（info, warn, error）
- 是否將 log 傳送至外部監控（如 Logflare, Sentry, Supabase Log Explorer）

### 9. 🚨 監控與警示系統
- 是否整合應用層監控（如 Uptime, StatusPage）
- 是否能監控 Edge Function、API Rate、Redis、DB CPU/IO
- 是否設有 SLA 或錯誤警報通知機制

### 10. 📚 Documentation 與可移交性
- 有無更新良好的 README / module 說明
- 是否具備 onboarding 流程
- 對外文件是否清楚 API、Schema、角色使用邏輯

## 審核報告輸出路徑: docs/Project-Restructure/audit/FullAudit-v[X.X.X].md

## 審核報告模板
# 📋 最終系統審核報告 - v[X.X.X]

**審核版本**: v[X.X.X]  
**基準版本**: v[X.X.X]  
**審核範圍**: [具體系統/模組]  
**審核人**: 最終審核員 (Final Auditor)  
**審核狀態**: 🔍 進行中 / ✅ 已完成

## 📊 審核執行摘要

### 🎯 審核目標
- **主要目標**: [整體架構、流程、代碼品質審核]
- **審核深度**: [企業級可維護性審核]
- **審核標準**: [基於 docs/general_rules.md 編碼原則]

### 📈 審核統計
- **審核模組數**: X 個
- **審核文件數**: X 個
- **發現問題數**: X 個
- **優化建議數**: X 個

## ✅ 審核項目檢查

### 1. 🔄 Workflow 分析
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **業務邏輯一致性**: [評估結果]
- **UX 原則遵守**: [評估結果]
- **流程重複性**: [發現的重複或冗餘]
- **改進建議**: [具體建議]

### 2. 📊 Dataflow 檢查
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **重複讀寫**: [發現的重複操作]
- **資料處理位置**: [DB層 vs 前端處理評估]
- **API 結構效率**: [GraphQL/RPC/REST 使用評估]
- **改進建議**: [具體建議]

### 3. 🧼 Code Quality & 清潔度
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **DRY 原則**: [重複代碼評估]
- **KISS 原則**: [簡單性評估]
- **SoC 原則**: [關注點分離評估]
- **測試代碼**: [console.log 和測試代碼殘留]
- **改進建議**: [具體建議]

### 4. 🧱 Component 維護性審核
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **組件版本**: [新舊組件共存情況]
- **統一性**: [組件統一程度]
- **Legacy 組件**: [舊組件遷移狀況]
- **改進建議**: [具體建議]

### 5. 🌐 UI & 語言一致性
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **語言統一**: [英文使用情況]
- **UI 一致性**: [介面一致性評估]
- **改進建議**: [具體建議]

### 6. 🔒 系統安全性
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **Auth 驗證**: [Supabase Auth/JWT 實施]
- **RLS 政策**: [Row Level Security 覆蓋]
- **權限控制**: [RBAC/metadata 權限]
- **錯誤處理**: [資訊洩露防護]
- **改進建議**: [具體建議]

### 7. 🧪 測試覆蓋率
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **單元測試**: [覆蓋率和質量]
- **整合測試**: [API 測試情況]
- **E2E 測試**: [端到端測試]
- **CI 整合**: [自動化測試整合]
- **改進建議**: [具體建議]

### 8. 📈 Logging 與分類
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **日誌完整性**: [關鍵操作日誌]
- **日誌等級**: [info/warn/error 分類]
- **外部監控**: [Logflare/Sentry 整合]
- **改進建議**: [具體建議]

### 9. 🚨 監控與警示系統
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **應用監控**: [Uptime/StatusPage]
- **系統監控**: [Edge Function/API/DB 監控]
- **SLA 機制**: [服務等級協議]
- **改進建議**: [具體建議]

### 10. 📚 Documentation 與可移交性
- **檢查狀態**: ✅ 優秀 / 🟡 良好 / 🟠 需改進 / 🔴 嚴重問題
- **文檔完整性**: [README/API/Schema 文檔]
- **移交準備**: [onboarding 流程]
- **知識傳承**: [技術文檔和最佳實踐]
- **改進建議**: [具體建議]

## 🏆 綜合評估

### 📊 系統健康度評分
- **整體評分**: X/10
- **架構設計**: X/10
- **代碼品質**: X/10
- **安全性**: X/10
- **可維護性**: X/10
- **文檔完整性**: X/10

### 🎯 關鍵優勢
1. **[優勢1]**: [具體描述]
2. **[優勢2]**: [具體描述]
3. **[優勢3]**: [具體描述]

### ⚠️ 關鍵風險
1. **[風險1]**: [具體描述和影響]
2. **[風險2]**: [具體描述和影響]
3. **[風險3]**: [具體描述和影響]

## 📋 優化建議與行動計劃

### 🚀 立即執行 (v[X.X.X])
- [ ] 🔴 [嚴重問題1] - 修復版本: v[X.X.X]
- [ ] 🔴 [嚴重問題2] - 修復版本: v[X.X.X]
- [ ] 🔴 [嚴重問題3] - 修復版本: v[X.X.X]

### 📅 短期計劃 (v[X.X.X] - v[X.X.X])
- [ ] 🟡 [中等問題1] - 目標版本: v[X.X.X]
- [ ] 🟡 [中等問題2] - 目標版本: v[X.X.X]
- [ ] 🟡 [改進建議1] - 目標版本: v[X.X.X]

### 🔮 長期計劃 (v[X.X.X] - v[X.X.X])
- [ ] 🟢 [輕微問題1] - 目標版本: v[X.X.X]
- [ ] 🟢 [架構優化1] - 目標版本: v[X.X.X]
- [ ] 🟢 [功能增強1] - 目標版本: v[X.X.X]

## 🎯 成功指標

### 📈 量化目標
- **代碼品質**: 提升到 X/10
- **測試覆蓋率**: 達到 X%
- **系統可用性**: 達到 99.X%
- **響應時間**: 平均 <Xms

### 🏆 質量目標
- **架構清晰度**: [具體目標]
- **文檔完整性**: [具體目標]
- **團隊效率**: [具體目標]

---

**審核完成版本**: v[X.X.X]  
**下次審核版本**: v[X.X.X]  
**審核人**: 最終審核員 (Final Auditor)  
**技術視角**: 技術總監級視角
