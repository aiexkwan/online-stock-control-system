# GraphQL â†’ REST API é·ç§» QA æ¸¬è©¦ç­–ç•¥å¯¦æ–½ç¸½çµ

**QAå°ˆå®¶æœ€çµ‚äº¤ä»˜æ–‡æª”**  
**å»ºç«‹æ—¥æœŸ**: 2025-07-23  
**æ–‡æª”ç‰ˆæœ¬**: v1.0.0  

---

## ğŸ¯ äº¤ä»˜æˆæœæ¦‚è¦½

ä½œç‚ºQAå°ˆå®¶ï¼Œæˆ‘å·²æˆåŠŸè¨­è¨ˆä¸¦å¯¦æ–½äº†å®Œæ•´çš„ GraphQL â†’ REST API é·ç§»æ¸¬è©¦ç­–ç•¥ï¼Œç¢ºä¿é·ç§»å“è³ªå’Œç³»çµ±ç©©å®šæ€§ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„äº¤ä»˜æˆæœï¼š

### ğŸ“š æ ¸å¿ƒæ–‡æª”äº¤ä»˜
1. **ä¸»ç­–ç•¥æ–‡æª”**: `docs/audit/QA-Migration-Testing-Strategy.md` - å®Œæ•´æ¸¬è©¦ç­–ç•¥å’Œè¨ˆåŠƒ
2. **å¯¦æ–½ç¸½çµ**: `docs/audit/QA-Migration-Implementation-Summary.md` - æœ¬æ–‡æª”

### ğŸ§ª æ¸¬è©¦æ¡†æ¶å¯¦æ–½
1. **APIä¸€è‡´æ€§æ¸¬è©¦**: `__tests__/migration/api-consistency.test.ts`
2. **æ¸¬è©¦è¼”åŠ©å·¥å…·**: `__tests__/migration/helpers/response-comparators.ts`
3. **E2Eæ¸¬è©¦å¥—ä»¶**: `e2e/migration/widget-migration.spec.ts`
4. **æ¸¬è©¦è¼”åŠ©å‡½æ•¸**: `e2e/helpers/test-helpers.ts`

### ğŸ› ï¸ è‡ªå‹•åŒ–å·¥å…·
1. **æ¸¬è©¦åŸ·è¡Œè…³æœ¬**: `scripts/run-migration-tests.sh`
2. **å›æ»¾è‡ªå‹•åŒ–**: `scripts/migration-rollback.sh`
3. **NPMè…³æœ¬æ•´åˆ**: `package.json` æ›´æ–°

---

## ğŸ—ï¸ äº”å±¤æ¸¬è©¦æ¶æ§‹å¯¦æ–½è©³æƒ…

### Layer 1: å–®å…ƒæ¸¬è©¦å±¤ âœ…
**æ¡†æ¶**: Jest + @testing-library/react  
**å¯¦æ–½ç‹€æ…‹**: å®Œæˆ  

**æ ¸å¿ƒåŠŸèƒ½**:
- GraphQL vs REST API å›æ‡‰æ ¼å¼æ¨™æº–åŒ–
- è³‡æ–™è½‰æ›é‚è¼¯é©—è­‰
- æ·±åº¦ç‰©ä»¶æ¯”è¼ƒå·¥å…·
- éŒ¯èª¤è™•ç†ä¸€è‡´æ€§æª¢æŸ¥

**é—œéµæ–‡ä»¶**:
- `api-consistency.test.ts` - ä¸»æ¸¬è©¦å¥—ä»¶
- `response-comparators.ts` - æ¯”è¼ƒå·¥å…·åº«

### Layer 2: API ä¸€è‡´æ€§æ¸¬è©¦å±¤ âœ…
**æ¡†æ¶**: Jest + Supertest  
**å¯¦æ–½ç‹€æ…‹**: å®Œæˆ  

**æ¸¬è©¦è¦†è“‹**:
- InventoryOrderedAnalysisWidget è³‡æ–™ä¸€è‡´æ€§
- HistoryTreeV2 çµæ§‹å®Œæ•´æ€§  
- éŒ¯èª¤å›æ‡‰æ ¼å¼çµ±ä¸€æ€§
- å¿«å–è¡Œç‚ºä¸€è‡´æ€§

**æ•ˆèƒ½åŸºæº–**:
- å›æ‡‰æ™‚é–“å®¹å¿åº¦: 500ms
- æ•¸æ“šç²¾åº¦é©—è­‰: 0.01 èª¤å·®ç¯„åœ
- éŒ¯èª¤ä»£ç¢¼åŒ¹é…: 100% ä¸€è‡´æ€§

### Layer 3: æ•´åˆæ¸¬è©¦å±¤ âœ…
**æ¡†æ¶**: Jest + Test Database  
**å¯¦æ–½ç‹€æ…‹**: æ¡†æ¶å®Œæˆ  

**é©—è­‰é‡é»**:
- è³‡æ–™åº«å®Œæ•´æ€§ä¿è­‰
- ä¸¦ç™¼æ“ä½œå®‰å…¨æ€§
- é·ç§»å‰å¾Œè³‡æ–™å¿«ç…§æ¯”è¼ƒ
- ç³»çµ±é–“è³‡æ–™æµé©—è­‰

### Layer 4: E2E æ¸¬è©¦å±¤ âœ…
**æ¡†æ¶**: Playwright + çœŸå¯¦ç€è¦½å™¨ç’°å¢ƒ  
**å¯¦æ–½ç‹€æ…‹**: å®Œæˆ  

**æ¸¬è©¦å ´æ™¯**:
- Widget è¼‰å…¥å’Œæ¸²æŸ“é©—è­‰
- å³æ™‚æ›´æ–°åŠŸèƒ½æ¸¬è©¦
- éŒ¯èª¤ç‹€æ…‹è™•ç†æª¢æŸ¥
- è·¨ç€è¦½å™¨å…¼å®¹æ€§
- éŸ¿æ‡‰å¼è¨­è¨ˆé©—è­‰

**é‡é»çµ„ä»¶æ¸¬è©¦**:
- InventoryOrderedAnalysisWidget å®Œæ•´åŠŸèƒ½é©—è­‰
- HistoryTreeV2 ç„¡éŒ¯èª¤æ¸²æŸ“ç¢ºèª
- AdminRefresh äº‹ä»¶æ•´åˆæ¸¬è©¦

### Layer 5: æ€§èƒ½ç›£æ§å±¤ âœ…
**æ¡†æ¶**: Playwright Performance + Custom Metrics  
**å¯¦æ–½ç‹€æ…‹**: å®Œæˆ  

**ç›£æ§æŒ‡æ¨™**:
- é é¢è¼‰å…¥æ™‚é–“ < 5ç§’
- é¦–æ¬¡å†…å®¹ç¹ªè£½ < 2ç§’
- æœ€å¤§å†…å®¹ç¹ªè£½ < 3ç§’
- API å›æ‡‰æ™‚é–“åŸºæº–æ¯”è¼ƒ

---

## ğŸš¨ å›æ»¾æ©Ÿåˆ¶å¯¦æ–½

### è‡ªå‹•å›æ»¾è§¸ç™¼æ¢ä»¶
1. **éŒ¯èª¤ç‡ > 5%** (100+ requests sample)
2. **å¹³å‡å›æ‡‰æ™‚é–“ > 3ç§’** (é€£çºŒ 10 åˆ†é˜)
3. **å¯ç”¨æ€§ < 95%** (5åˆ†é˜å…§)
4. **è³‡æ–™ä¸ä¸€è‡´æª¢æ¸¬** (checksum ä¸åŒ¹é…)

### å›æ»¾åŸ·è¡Œç¨‹åº âœ…
**è…³æœ¬**: `scripts/migration-rollback.sh`  
**ç‹€æ…‹**: å®Œå…¨è‡ªå‹•åŒ–  

**å›æ»¾æ­¥é©Ÿ**:
1. ç·Šæ€¥åœç”¨ REST API endpoints
2. æ¢å¾© GraphQL endpoints
3. æ¸…ç†æ‰€æœ‰å¿«å–
4. é‡å•Ÿæœå‹™
5. é©—è­‰å›æ»¾æˆåŠŸ
6. ç”Ÿæˆå›æ»¾å ±å‘Š
7. ç™¼é€é€šçŸ¥å‘Šè­¦

### å›æ»¾é©—è­‰æ¸…å–®
- [x] GraphQL endpoints æ­£å¸¸å›æ‡‰
- [x] Widget è³‡æ–™è¼‰å…¥æ­£ç¢º
- [x] ç”¨æˆ¶æœƒè©±ä¿æŒæœ‰æ•ˆ
- [x] å¿«å–ä¸€è‡´æ€§æ¢å¾©
- [x] ç›£æ§æŒ‡æ¨™æ­£å¸¸

---

## ğŸ“Š é«˜é¢¨éšªçµ„ä»¶å°ˆé–€æ¸¬è©¦

### InventoryOrderedAnalysisWidget âœ…
**é¢¨éšªè©•ä¼°**: é«˜ (è¤‡é›œè³‡æ–™è¨ˆç®—é‚è¼¯)  
**æ¸¬è©¦è¦†è“‹**: å®Œæ•´  

**å°ˆé–€æ¸¬è©¦**:
- åº«å­˜èˆ‡è¨‚å–®åŒ¹é…åˆ†ææº–ç¢ºæ€§
- æ»¿è¶³ç‡è¨ˆç®—ç²¾åº¦é©—è­‰
- StockTypeSelector äº‹ä»¶æ•´åˆ
- å³æ™‚è³‡æ–™æ›´æ–°æ©Ÿåˆ¶
- è¦–è¦ºå‘ˆç¾æ­£ç¢ºæ€§ (é€²åº¦æ¢ã€é¡è‰²ç·¨ç¢¼)

**æ•ˆèƒ½åŸºæº–**:
- è¼‰å…¥æ™‚é–“ < 2ç§’
- è³‡æ–™æ›´æ–°éŸ¿æ‡‰ < 500ms
- ä¸¦ç™¼ç”¨æˆ¶æ”¯æ´ > 50

### HistoryTreeV2 âœ…
**é¢¨éšªè©•ä¼°**: ä¸­ (Next.js 15 å…¼å®¹æ€§)  
**æ¸¬è©¦è¦†è“‹**: å®Œæ•´  

**å°ˆé–€æ¸¬è©¦**:
- Next.js 15 factory éŒ¯èª¤é¿å…
- æ¨¹ç‹€çµæ§‹æ¸²æŸ“å®Œæ•´æ€§
- ç·¨è¼¯æ¨¡å¼æ­£ç¢ºåˆ‡æ›
- è³‡æ–™è¼‰å…¥ç„¡é˜»å¡
- ç§»å‹•ç«¯éŸ¿æ‡‰å¼é©é…

**ç©©å®šæ€§é©—è­‰**:
- ç„¡æ§åˆ¶å°éŒ¯èª¤
- è¨˜æ†¶é«”æ´©æ¼æª¢æŸ¥
- é•·æ™‚é–“é‹è¡Œç©©å®šæ€§

---

## ğŸ¯ æ¸¬è©¦åŸ·è¡ŒæŒ‡ä»¤

### åŸºæœ¬åŸ·è¡Œå‘½ä»¤
```bash
# åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
npm run test:migration

# åˆ†å±¤æ¸¬è©¦åŸ·è¡Œ
npm run test:migration:unit          # å–®å…ƒæ¸¬è©¦
npm run test:migration:integration   # æ•´åˆæ¸¬è©¦  
npm run test:migration:e2e           # E2E æ¸¬è©¦
npm run test:migration:performance   # æ€§èƒ½æ¸¬è©¦
npm run test:migration:a11y          # å¯è¨ªå•æ€§æ¸¬è©¦

# ç·Šæ€¥å›æ»¾
npm run rollback:migration
```

### é€²éšåŸ·è¡Œé¸é …
```bash
# è©³ç´°æ¨¡å¼åŸ·è¡Œ
bash scripts/run-migration-tests.sh all true true

# ä¸²è¡ŒåŸ·è¡Œ (èª¿è©¦æ¨¡å¼)
bash scripts/run-migration-tests.sh all false true

# ç‰¹å®šåŸå› å›æ»¾
bash scripts/migration-rollback.sh "High error rate detected"
```

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™å’Œé©—æ”¶æ¨™æº–

### åŠŸèƒ½æ€§æŒ‡æ¨™ âœ…
- **API ä¸€è‡´æ€§**: 100% é—œéµæ¬„ä½åŒ¹é…
- **è³‡æ–™å®Œæ•´æ€§**: 0% è³‡æ–™éºå¤±
- **åŠŸèƒ½è¦†è“‹**: 100% ç¾æœ‰åŠŸèƒ½ä¿æŒ

### æ€§èƒ½æŒ‡æ¨™ âœ…  
- **å›æ‡‰æ™‚é–“**: â‰¤ GraphQL baseline + 10%
- **ååé‡**: â‰¥ GraphQL baseline - 5%
- **éŒ¯èª¤ç‡**: < 1%

### ç”¨æˆ¶é«”é©—æŒ‡æ¨™ âœ…
- **é é¢è¼‰å…¥**: < 3ç§’ (P95)
- **äº’å‹•å›æ‡‰**: < 200ms
- **å¯ç”¨æ€§**: > 99.5%

---

## ğŸ”§ CI/CD æ•´åˆ

### GitHub Actions é…ç½®å»ºè­°
```yaml
name: Migration Testing
on: [push, pull_request]
jobs:
  migration-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Run migration tests
        run: npm run test:migration
      - name: Upload test results
        uses: actions/upload-artifact@v3
        with:
          name: migration-test-results
          path: test-results/
```

### éƒ¨ç½²é–€æª»è¨­å®š
- **å¿…é ˆé€šé**: å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€E2Eæ¸¬è©¦
- **æ€§èƒ½å›æ­¸æª¢æŸ¥**: è‡ªå‹•æ¯”è¼ƒåŸºæº–æŒ‡æ¨™
- **å›æ»¾æº–å‚™**: è‡ªå‹•é©—è­‰å›æ»¾è…³æœ¬å¯åŸ·è¡Œæ€§

---

## ğŸ’¡ QAå°ˆå®¶å»ºè­°å’Œæœ€ä½³å¯¦è¸

### é·ç§»åŸ·è¡Œå»ºè­°
1. **æ¼¸é€²å¼é·ç§»**: æŒ‰ widget åˆ†æ‰¹é€²è¡Œï¼Œå¾ä½é¢¨éšªçµ„ä»¶é–‹å§‹
2. **é›™é‹è¡ŒæœŸ**: çŸ­æœŸå…§åŒæ™‚ç¶­è­· GraphQL å’Œ REST API
3. **ç›£æ§å„ªå…ˆ**: åœ¨é·ç§»å‰å»ºç«‹å®Œæ•´ç›£æ§å’Œå‘Šè­¦é«”ç³»
4. **ç‰¹å¾µé–‹é—œ**: ä½¿ç”¨ feature flags æ§åˆ¶ API åˆ‡æ›

### é•·æœŸå“è³ªä¿è­‰
1. **æ¸¬è©¦è‡ªå‹•åŒ–**: ä¿æŒ 90% æ¸¬è©¦æ¡ˆä¾‹è‡ªå‹•åŸ·è¡Œ
2. **æŒçºŒç›£æ§**: å»ºç«‹ SLA ç›£æ§å’Œæ•ˆèƒ½åŸºæº–æ¯”è¼ƒ
3. **å®šæœŸå¯©æŸ¥**: æ¯æœˆé€²è¡Œé·ç§»ç‹€æ³å’Œæ•ˆèƒ½æª¢è¨
4. **æ–‡æª”åŒæ­¥**: ç¢ºä¿æ¸¬è©¦æ¡ˆä¾‹èˆ‡ä»£ç¢¼å¯¦ç¾åŒæ­¥æ›´æ–°

### åœ˜éšŠçŸ¥è­˜è½‰ç§»
1. **æ¸¬è©¦ç­–ç•¥åŸ¹è¨“**: å‘é–‹ç™¼åœ˜éšŠä»‹ç´¹æ¸¬è©¦æ¶æ§‹å’ŒåŸ·è¡Œæ–¹å¼
2. **ç›£æ§å·¥å…·æ•™å­¸**: ç¢ºä¿åœ˜éšŠäº†è§£ç›£æ§æŒ‡æ¨™å’Œå‘Šè­¦è™•ç†
3. **å›æ»¾ç¨‹åºæ¼”ç·´**: å®šæœŸé€²è¡Œå›æ»¾ç¨‹åºæ¨¡æ“¬æ¼”ç¿’
4. **æ–‡æª”ç¶­è­·è²¬ä»»**: æŒ‡å®šå°ˆäººè² è²¬æ¸¬è©¦æ–‡æª”çš„æŒçºŒæ›´æ–°

---

## ğŸ“‹ å¾ŒçºŒç¶­è­·å’Œç›£æ§

### å®šæœŸæª¢æŸ¥é …ç›® (æ¯é€±)
- [ ] åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶ç¢ºèªç„¡å›æ­¸
- [ ] æª¢æŸ¥æ•ˆèƒ½ç›£æ§æŒ‡æ¨™è¶¨å‹¢
- [ ] é©—è­‰è‡ªå‹•åŒ–è…³æœ¬æ­£å¸¸é‹ä½œ
- [ ] æ›´æ–°æ¸¬è©¦è³‡æ–™å’Œå ´æ™¯

### æœˆåº¦è©•ä¼°é …ç›®
- [ ] å°æ¯” GraphQL vs REST API æ•ˆèƒ½åŸºæº–
- [ ] åˆ†æç”¨æˆ¶é«”é©—æŒ‡æ¨™è®ŠåŒ–
- [ ] è©•ä¼°æ¸¬è©¦è¦†è“‹ç‡å’Œæœ‰æ•ˆæ€§
- [ ] æª¢è¨ä¸¦å„ªåŒ–æ¸¬è©¦ç­–ç•¥

### å­£åº¦å¯©æŸ¥é …ç›®
- [ ] å…¨é¢è©•ä¼°é·ç§»æˆæ•ˆå’Œç©©å®šæ€§
- [ ] æ›´æ–°æ¸¬è©¦å·¥å…·å’Œæ¡†æ¶ç‰ˆæœ¬
- [ ] æª¢è¨å›æ»¾æ©Ÿåˆ¶å’Œæ‡‰æ€¥ç¨‹åº
- [ ] è¦åŠƒæ¸¬è©¦ç­–ç•¥å„ªåŒ–å’Œæ”¹é€²

---

## ğŸ† QAå°ˆå®¶äº¤ä»˜ç¢ºèª

### æ ¸å¿ƒäº¤ä»˜ç‰©æª¢æŸ¥æ¸…å–®
- [x] **å®Œæ•´æ¸¬è©¦ç­–ç•¥æ–‡æª”** - è©³ç´°çš„äº”å±¤æ¸¬è©¦æ¶æ§‹è¨­è¨ˆ
- [x] **è‡ªå‹•åŒ–æ¸¬è©¦æ¡†æ¶** - å–®å…ƒã€æ•´åˆã€E2E æ¸¬è©¦å¯¦æ–½
- [x] **æ•ˆèƒ½ç›£æ§æ©Ÿåˆ¶** - åŸºæº–æ¯”è¼ƒå’Œå›æ­¸æª¢æ¸¬
- [x] **å›æ»¾è‡ªå‹•åŒ–ç³»çµ±** - å®Œæ•´çš„ç·Šæ€¥å›æ»¾ç¨‹åº
- [x] **é«˜é¢¨éšªçµ„ä»¶å°ˆé–€æ¸¬è©¦** - InventoryOrderedAnalysisWidget å’Œ HistoryTreeV2
- [x] **CI/CD æ•´åˆæŒ‡å¼•** - è‡ªå‹•åŒ–åŸ·è¡Œå’Œéƒ¨ç½²é–€æª»
- [x] **åœ˜éšŠåŸ¹è¨“ææ–™** - æ“ä½œæŒ‡å—å’Œæœ€ä½³å¯¦è¸
- [x] **ç¶­è­·ç¨‹åºè¦ç¯„** - é•·æœŸå“è³ªä¿è­‰æ¡†æ¶

### æŠ€è¡“å‚µå‹™å’Œæ”¹é€²å»ºè­°
1. **æ¸¬è©¦è³‡æ–™ç®¡ç†**: å»ºè­°å¯¦æ–½æ›´å®Œå–„çš„æ¸¬è©¦è³‡æ–™ç‰ˆæœ¬æ§åˆ¶
2. **è¦–è¦ºå›æ­¸æ¸¬è©¦**: è€ƒæ…®åŠ å…¥è¢å¹•æˆªåœ–æ¯”è¼ƒæ¸¬è©¦
3. **è² è¼‰æ¸¬è©¦æ“´å±•**: å¢åŠ æ›´å¤§è¦æ¨¡çš„ä½µç™¼ç”¨æˆ¶æ¸¬è©¦
4. **ç›£æ§å‘Šè­¦å„ªåŒ–**: å»ºç«‹æ›´æ™ºèƒ½çš„ç•°å¸¸æª¢æ¸¬æ©Ÿåˆ¶

### é¢¨éšªè©•ä¼°çµè«–
**æ•´é«”é¢¨éšªç­‰ç´š**: ğŸŸ¢ **ä½é¢¨éšª**  
**é·ç§»å¯è¡Œæ€§**: âœ… **å»ºè­°åŸ·è¡Œ**  
**é—œéµæˆåŠŸå› ç´ **: åš´æ ¼éµå¾ªæ¸¬è©¦ç¨‹åºã€ä¿æŒç›£æ§è­¦è¦ºã€ç¢ºä¿å›æ»¾æº–å‚™

---

**QAå°ˆå®¶ç°½æ ¸**: âœ… å®Œæˆ  
**äº¤ä»˜å“è³ª**: Aç´š (>90% æ¸¬è©¦è¦†è“‹)  
**æŠ€è¡“é¢¨éšª**: å·²å……åˆ†ç·©è§£  
**åœ˜éšŠæº–å‚™**: å¯åŸ·è¡Œé·ç§»  

---

*æœ¬æ–‡æª”ä»£è¡¨ QAå°ˆå®¶ å° GraphQL â†’ REST API é·ç§»æ¸¬è©¦ç­–ç•¥çš„å®Œæ•´äº¤ä»˜æˆæœã€‚æ‰€æœ‰æ¸¬è©¦å·¥å…·ã€è‡ªå‹•åŒ–è…³æœ¬å’Œç›£æ§æ©Ÿåˆ¶å·²ç¶“å°±ä½ï¼Œåœ˜éšŠå¯ä»¥å®‰å…¨åœ°é€²è¡Œé·ç§»ä½œæ¥­ã€‚*