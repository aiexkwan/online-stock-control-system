# ORDER LOADING å‰©é¤˜å„ªåŒ–æ©Ÿæœƒ

## å·²å®Œæˆçš„å„ªåŒ– âœ…
1. **åŸå­äº‹å‹™å¯¦ç¾** - ä½¿ç”¨ RPC å‡½æ•¸ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§
2. **æ°¸ä¹…é‡è¤‡é˜²æ­¢** - æª¢æŸ¥æ‰€æœ‰æ­·å²è¨˜éŒ„é˜²æ­¢é‡è¤‡åŠ è¼‰
3. **çµ±ä¸€æ•¸æ“šå­˜å„²** - çµ±ä¸€ä½¿ç”¨ record_history è¡¨
4. **åº«å­˜ç´šåˆ¥è¿½è¹¤** - åŠ è¼‰/æ’¤éŠ·æ™‚è‡ªå‹•æ›´æ–° stock_level
5. **UI å„ªåŒ–** - ç§»é™¤è‡ªå‹•æª¢æ¸¬æç¤ºï¼Œç°¡åŒ–æƒææ­·å²é¡¯ç¤º
6. **æ’¤éŠ·åŠŸèƒ½æ•´åˆ** - åœ¨æ­·å²è¨˜éŒ„ä¸­ç›´æ¥æä¾›æ’¤éŠ·æŒ‰éˆ•

## å‰©é¤˜å„ªåŒ–æ©Ÿæœƒ ğŸš€

### 1. æ€§èƒ½å„ªåŒ–
- **æ‰¹é‡æŸ¥è©¢å„ªåŒ–**
  - ç•¶å‰æ¯æ¬¡æƒæéƒ½åŸ·è¡Œå¤šæ¬¡æ•¸æ“šåº«æŸ¥è©¢
  - å»ºè­°ï¼šåˆä½µæŸ¥è©¢ï¼Œä½¿ç”¨å–®ä¸€ RPC å‡½æ•¸è¿”å›æ‰€æœ‰éœ€è¦çš„æ•¸æ“š
  
- **ç·©å­˜æ©Ÿåˆ¶**
  - è¨‚å–®æ•¸æ“šåœ¨æœƒè©±æœŸé–“å¾ˆå°‘è®ŠåŒ–
  - å»ºè­°ï¼šå¯¦ç¾å®¢æˆ¶ç«¯ç·©å­˜ï¼Œæ¸›å°‘é‡è¤‡æŸ¥è©¢

- **é åŠ è¼‰å¸¸ç”¨æ•¸æ“š**
  - ç”¢å“ä¿¡æ¯ã€ç”¨æˆ¶æ¬Šé™ç­‰
  - å»ºè­°ï¼šä½¿ç”¨ React Query æˆ– SWR é€²è¡Œæ•¸æ“šç·©å­˜

### 2. å¯¦æ™‚å”ä½œåŠŸèƒ½
- **WebSocket æ•´åˆ**
  - å¤šç”¨æˆ¶åŒæ™‚æ“ä½œæ™‚çš„å¯¦æ™‚æ›´æ–°
  - å»ºè­°ï¼šä½¿ç”¨ Supabase Realtime ç›£è½è¨‚å–®è®ŠåŒ–
  
- **æ¨‚è§€æ›´æ–°**
  - æé«˜ UI éŸ¿æ‡‰é€Ÿåº¦
  - å»ºè­°ï¼šå…ˆæ›´æ–° UIï¼Œå¾Œå°ç¢ºèªå¾Œå†åŒæ­¥

### 3. éŒ¯èª¤è™•ç†å’Œæ¢å¾©
- **é›¢ç·šæ”¯æŒ**
  - ç¶²çµ¡ä¸ç©©å®šæ™‚ç¹¼çºŒå·¥ä½œ
  - å»ºè­°ï¼šå¯¦ç¾é›¢ç·šéšŠåˆ—ï¼Œæ¢å¾©é€£æ¥å¾Œè‡ªå‹•åŒæ­¥

- **æ‰¹é‡æ“ä½œå¤±æ•—æ¢å¾©**
  - éƒ¨åˆ†æˆåŠŸçš„æ‰¹é‡æ“ä½œå›æ»¾
  - å»ºè­°ï¼šå¯¦ç¾äº‹å‹™æ—¥èªŒå’Œæ¢å¾©æ©Ÿåˆ¶

### 4. ç”¨æˆ¶é«”é©—å¢å¼·
- **æ™ºèƒ½å»ºè­°**
  - åŸºæ–¼æ­·å²æ•¸æ“šé æ¸¬ä¸‹ä¸€å€‹å¯èƒ½çš„æƒæ
  - å»ºè­°ï¼šå¯¦ç¾åŸºæ–¼æ¨¡å¼çš„é æ¸¬ç®—æ³•

- **éµç›¤å¿«æ·éµ**
  - æé«˜æ“ä½œæ•ˆç‡
  - å»ºè­°ï¼šæ·»åŠ å¸¸ç”¨æ“ä½œçš„å¿«æ·éµ

- **é€²åº¦å¯è¦–åŒ–**
  - æ›´ç›´è§€çš„è¨‚å–®å®Œæˆç‹€æ…‹
  - å»ºè­°ï¼šæ·»åŠ åœ–è¡¨å’Œå‹•ç•«æ•ˆæœ

### 5. ç›£æ§å’Œåˆ†æ
- **æ€§èƒ½æŒ‡æ¨™æ”¶é›†**
  ```typescript
  interface PerformanceMetrics {
    scanTime: number;
    queryTime: number;
    renderTime: number;
    totalOperationTime: number;
  }
  ```

- **ç”¨æˆ¶è¡Œç‚ºåˆ†æ**
  - è¿½è¹¤æœ€å¸¸ç”¨åŠŸèƒ½
  - è­˜åˆ¥æ“ä½œç“¶é ¸

### 6. æ¥­å‹™é‚è¼¯å„ªåŒ–
- **æ™ºèƒ½åˆ†é…ç®—æ³•**
  - è‡ªå‹•å»ºè­°æœ€å„ªçš„å¡æ¿åˆ†é…æ–¹æ¡ˆ
  - è€ƒæ…®å€‰åº«ä½ç½®ã€åˆ°æœŸæ—¥æœŸç­‰å› ç´ 

- **é è­¦æ©Ÿåˆ¶**
  - è¨‚å–®å³å°‡è¶…é‡è­¦å‘Š
  - åº«å­˜ä¸è¶³æé†’

## å¯¦æ–½å„ªå…ˆç´š

### é«˜å„ªå…ˆç´š (1-2 é€±)
1. æ‰¹é‡æŸ¥è©¢å„ªåŒ–
2. å®¢æˆ¶ç«¯ç·©å­˜å¯¦ç¾
3. åŸºæœ¬éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶

### ä¸­å„ªå…ˆç´š (3-4 é€±)
1. Realtime æ•´åˆ
2. é›¢ç·šæ”¯æŒ
3. æ€§èƒ½ç›£æ§

### ä½å„ªå…ˆç´š (1-2 æœˆ)
1. æ™ºèƒ½å»ºè­°ç³»çµ±
2. é«˜ç´šåˆ†æåŠŸèƒ½
3. è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶

## æŠ€è¡“å¯¦æ–½å»ºè­°

### 1. ä½¿ç”¨ React Query é€²è¡Œæ•¸æ“šç®¡ç†
```typescript
const { data: orderData, refetch } = useQuery({
  queryKey: ['order', orderRef],
  queryFn: () => fetchOrderDetails(orderRef),
  staleTime: 5 * 60 * 1000, // 5 minutes
  cacheTime: 10 * 60 * 1000, // 10 minutes
});
```

### 2. å¯¦ç¾ Supabase Realtime
```typescript
useEffect(() => {
  const channel = supabase
    .channel('order-updates')
    .on('postgres_changes', 
      { event: '*', schema: 'public', table: 'data_order' },
      (payload) => {
        // Handle real-time updates
        refetch();
      }
    )
    .subscribe();

  return () => {
    supabase.removeChannel(channel);
  };
}, [orderRef]);
```

### 3. æ€§èƒ½ç›£æ§å¯¦ç¾
```typescript
const measurePerformance = async (operation: string, fn: Function) => {
  const start = performance.now();
  try {
    const result = await fn();
    const duration = performance.now() - start;
    
    // Log to monitoring service
    logPerformance({
      operation,
      duration,
      timestamp: new Date(),
      userId: currentUser.id,
    });
    
    return result;
  } catch (error) {
    // Handle error
    throw error;
  }
};
```

## é æœŸæ•ˆæœ
- æŸ¥è©¢é€Ÿåº¦æå‡ 50-70%
- ç”¨æˆ¶æ“ä½œéŸ¿æ‡‰æ™‚é–“ < 200ms
- æ”¯æŒ 10+ ç”¨æˆ¶åŒæ™‚æ“ä½œ
- éŒ¯èª¤æ¢å¾©ç‡ > 95%
- ç³»çµ±å¯ç”¨æ€§ > 99.9%