# 相機功能問題排除指南

## 問題現象
- 無法調用相機（PC 和手機都無法使用）
- QR 掃描器無法啟動
- 相機權限請求失敗

## 診斷步驟

### 1. 使用基礎診斷工具
在 `/stock-take/cycle-count` 頁面點擊 "Camera Diagnostics" 按鈕，按順序執行：

1. **檢查支持** - 驗證瀏覽器是否支持相機 API
2. **檢查設備** - 列出可用的相機設備
3. **請求權限** - 嘗試獲取相機權限並顯示視頻流

### 2. 常見問題與解決方案

#### A. 瀏覽器支持問題
**症狀**: MediaDevices API 不可用
**解決方案**:
- 確保使用現代瀏覽器（Chrome 53+, Firefox 36+, Safari 11+）
- 更新瀏覽器到最新版本

#### B. 安全上下文問題
**症狀**: SecurityError 或權限被拒絕
**解決方案**:
- 確保使用 `https://` 或 `localhost`
- 避免使用 IP 地址訪問（如 `192.168.x.x`）
- 檢查瀏覽器地址欄是否顯示安全鎖圖標

#### C. 權限問題
**症狀**: NotAllowedError
**解決方案**:
1. 檢查瀏覽器權限設置
2. 清除網站權限並重新授權
3. 檢查系統級相機權限

#### D. 設備占用問題
**症狀**: NotReadableError
**解決方案**:
- 關閉其他使用相機的應用程序
- 重啟瀏覽器
- 重啟設備

#### E. 設備不存在問題
**症狀**: NotFoundError
**解決方案**:
- 檢查相機硬件連接
- 更新相機驅動程序
- 檢查設備管理器中的相機狀態

### 3. 瀏覽器特定解決方案

#### Chrome
1. 進入 `chrome://settings/content/camera`
2. 確保相機訪問已啟用
3. 檢查網站權限列表
4. 嘗試重置網站權限

#### Firefox
1. 進入 `about:preferences#privacy`
2. 找到權限部分的相機設置
3. 檢查例外列表
4. 清除網站數據並重新授權

#### Safari
1. 進入 Safari > 偏好設置 > 網站
2. 選擇相機權限
3. 確保網站有相機訪問權限

#### Edge
1. 進入設置 > 網站權限 > 相機
2. 確保相機訪問已啟用
3. 檢查網站特定權限

### 4. 移動設備特定問題

#### iOS Safari
- 確保 iOS 版本 11.0+
- 檢查設置 > Safari > 相機權限
- 嘗試重新啟動 Safari

#### Android Chrome
- 確保 Chrome 版本 53+
- 檢查應用權限設置
- 清除 Chrome 應用數據

### 5. 系統級解決方案

#### Windows
1. 檢查隱私設置：
   - 設置 > 隱私 > 相機
   - 確保"允許應用訪問相機"已啟用
   - 確保"允許桌面應用訪問相機"已啟用

2. 檢查設備管理器：
   - 展開"相機"或"影像設備"
   - 確保設備正常工作
   - 更新驅動程序

#### macOS
1. 檢查系統偏好設置：
   - 系統偏好設置 > 安全性與隱私 > 相機
   - 確保瀏覽器有相機權限

#### Android
1. 檢查應用權限：
   - 設置 > 應用 > Chrome > 權限
   - 確保相機權限已啟用

### 6. 網絡相關問題

#### HTTPS 要求
- 現代瀏覽器要求 HTTPS 才能訪問相機
- localhost 是例外，可以使用 HTTP
- 確保證書有效

#### 代理/防火牆
- 某些企業網絡可能阻止媒體設備訪問
- 聯繫 IT 管理員檢查網絡策略

### 7. 替代解決方案

如果相機功能完全無法使用，可以：

1. **使用手動輸入**：
   - 點擊 "Manual Input" 按鈕
   - 手動輸入 QR Code 內容（如 PLT240001）

2. **使用外部掃描器**：
   - 使用手機的 QR 掃描應用
   - 將結果手動輸入到系統中

3. **使用專用設備**：
   - 使用專業的條碼掃描器
   - 配置為鍵盤輸入模式

### 8. 開發者調試

#### 控制台檢查
打開瀏覽器開發者工具（F12），檢查：
- Console 標籤中的錯誤信息
- Network 標籤中的請求狀態
- Application 標籤中的權限狀態

#### 常見錯誤代碼
- `NotAllowedError`: 用戶拒絕權限或瀏覽器阻止
- `NotFoundError`: 沒有找到相機設備
- `NotReadableError`: 設備被占用或硬件問題
- `OverconstrainedError`: 請求的約束無法滿足
- `SecurityError`: 安全上下文問題

### 9. 聯繫支持

如果以上步驟都無法解決問題，請提供以下信息：

1. 操作系統和版本
2. 瀏覽器和版本
3. 設備類型（PC/手機/平板）
4. 具體錯誤信息
5. 基礎診斷工具的輸出日誌
6. 是否在企業網絡環境中

## 測試清單

- [ ] 瀏覽器支持檢查通過
- [ ] 安全上下文確認（HTTPS 或 localhost）
- [ ] 相機設備檢測成功
- [ ] 權限請求成功
- [ ] 視頻流顯示正常
- [ ] QR 掃描功能正常
- [ ] 手動輸入功能可用作備選方案 