# æ¸…ç†åˆ†æå ±å‘Šï¼š/app/(auth)/main-login/reset/page.tsx

**åˆ†ææ—¥æœŸ**: 2025-08-31
**åˆ†æç‹€æ…‹**: âœ… å®Œæˆ
**æª”æ¡ˆè·¯å¾‘**: `/app/(auth)/main-login/reset/page.tsx`
**æª”æ¡ˆå¤§å°**: 155 è¡Œ
**æª”æ¡ˆé¡å‹**: Next.js é é¢çµ„ä»¶

## åŸ·è¡Œæ‘˜è¦

æ­¤æª”æ¡ˆç‚ºå¯†ç¢¼é‡ç½®é é¢çµ„ä»¶ï¼Œä½†æ ¸å¿ƒåŠŸèƒ½å®Œå…¨æœªå¯¦ç¾ã€‚é›–ç„¶ UI å®Œæ•´ä¸”è¢«å¤šè™•å¼•ç”¨ï¼Œä½†å¯¦éš›ä¸Šç„¡æ³•ç™¼é€é‡ç½®éƒµä»¶ï¼Œåƒ…é¡¯ç¤ºå‡æˆåŠŸè¨Šæ¯ã€‚**ä¸å»ºè­°åˆªé™¤**ï¼Œä½†éœ€è¦**ç«‹å³ä¿®å¾©**ã€‚

### é—œéµç™¼ç¾

- ğŸ”´ **åŠŸèƒ½ç¼ºé™·**: å¯†ç¢¼é‡ç½®é‚è¼¯æœªå¯¦ç¾
- ğŸ”´ **å®‰å…¨é¢¨éšª**: ç”¨æˆ¶ç„¡æ³•æ¢å¾©å¸³æˆ¶
- ğŸŸ¡ **ä»£ç¢¼å•é¡Œ**: å­˜åœ¨æœªä½¿ç”¨çš„ import å’Œé‡è¤‡çµ„ä»¶
- ğŸŸ¢ **UI å®Œæ•´**: ä»‹é¢è¨­è¨ˆç¬¦åˆç³»çµ±æ¨™æº–

## åˆ†ææ­¥é©Ÿé€²åº¦

- [x] æ­¥é©Ÿ 1ï¼šéœæ…‹åˆ†æ
- [x] æ­¥é©Ÿ 2ï¼šä¾è³´åˆ†æ
- [x] æ­¥é©Ÿ 3ï¼šé‹è¡Œæ™‚åˆ†æ
- [x] æ­¥é©Ÿ 4ï¼šå½±éŸ¿è©•ä¼°
- [x] æ­¥é©Ÿ 5ï¼šæœ€çµ‚å»ºè­°

---

## æ­¥é©Ÿ 1ï¼šéœæ…‹åˆ†æ (code-reviewer)

### 1.1 ä»£ç¢¼çµæ§‹åˆ†æ

**çµ„ä»¶é¡å‹**: å®¢æˆ¶ç«¯çµ„ä»¶ (`'use client'`)
**æ¡†æ¶**: Next.js 15 App Router
**ä¸»è¦åŠŸèƒ½**: å¯†ç¢¼é‡ç½®è«‹æ±‚ä»‹é¢

### 1.2 ä»£ç¢¼å“è³ªè©•ä¼°

#### å•é¡Œè­˜åˆ¥ï¼š

1. **åŠŸèƒ½æœªå¯¦ç¾** (ç¬¬30-31è¡Œ)

   ```typescript
   // Note: This is a simplified version. In a real app, you'd implement password reset
   setSuccess(true);
   ```

   - å¯¦éš›å¯†ç¢¼é‡ç½®é‚è¼¯å®Œå…¨ç¼ºå¤±
   - åƒ…é¡¯ç¤ºæˆåŠŸç‹€æ…‹ï¼Œç„¡å¯¦éš›ä½œç”¨

2. **æœªä½¿ç”¨çš„ import**
   - ç¬¬5è¡Œ: `import { unifiedAuth } from '../utils/unified-auth';`
   - å°å…¥ä½†å¾æœªä½¿ç”¨

3. **å‡åŠŸèƒ½å¯¦ç¾**
   - è¡¨å–®æäº¤å¾Œç›´æ¥è¨­ç½®æˆåŠŸç‹€æ…‹
   - æ²’æœ‰èª¿ç”¨ä»»ä½• API æˆ–èªè­‰æœå‹™
   - æ²’æœ‰ç™¼é€é‡ç½®éƒµä»¶çš„å¯¦éš›é‚è¼¯

### 1.3 è¨­è¨ˆæ¨¡å¼è©•ä¼°

- ä½¿ç”¨æ¨™æº– React hooks æ¨¡å¼
- è¡¨å–®è™•ç†é‚è¼¯åŸºæœ¬æ­£ç¢º
- UI çµæ§‹ç¬¦åˆç³»çµ±è¨­è¨ˆèªè¨€
- é›»å­éƒµä»¶åŸŸåé©—è­‰ç¡¬ç·¨ç¢¼ (@pennineindustries.com)

### 1.4 å®‰å…¨æ€§è€ƒé‡

- é›»å­éƒµä»¶é©—è­‰å­˜åœ¨ä½†ä¸å®Œæ•´
- æ²’æœ‰å¯¦éš›çš„å¾Œç«¯æ•´åˆ
- æ²’æœ‰ CSRF ä¿è­·æ©Ÿåˆ¶
- æ²’æœ‰é€Ÿç‡é™åˆ¶è€ƒæ…®

### éœæ…‹åˆ†æçµè«–

**é¢¨éšªç­‰ç´š**: ğŸŸ¡ ä¸­ç­‰
**æ ¸å¿ƒå•é¡Œ**: åŠŸèƒ½æœªå¯¦ç¾ï¼Œå­˜åœ¨èª¤å°æ€§æˆåŠŸæç¤º

---

## æ­¥é©Ÿ 2ï¼šä¾è³´åˆ†æ (frontend-developer + backend-architect)

### 2.1 å¼•ç”¨åˆ†æ

#### å…¥ç«™å¼•ç”¨ï¼ˆèª°å¼•ç”¨äº†æ­¤æª”æ¡ˆï¼‰

1. **ç›´æ¥è·¯ç”±éˆæ¥**:
   - `/app/(auth)/main-login/components/LoginForm.tsx` - "Forgot password?" éˆæ¥
   - `/app/(auth)/main-login/components/organisms/RefactoredLoginForm.tsx` - "Forgot password?" éˆæ¥
2. **è·¯ç”±é…ç½®**:
   - `/app/hooks/useAuth.ts` - åˆ—åœ¨å…¬é–‹è·¯ç”±é™£åˆ—ä¸­

3. **æ¸¬è©¦å ±å‘Š**:
   - Playwright æ¸¬è©¦å ±å‘Šä¸­æœ‰è¨˜éŒ„æ­¤è·¯ç”±

#### å‡ºç«™ä¾è³´ï¼ˆæ­¤æª”æ¡ˆä¾è³´èª°ï¼‰

1. **React æ ¸å¿ƒ**: `react`, `next/link`
2. **å·¥å…·åº«**: `../utils/unified-auth` (å°å…¥ä½†æœªä½¿ç”¨)

### 2.2 ä¾è³´å¥åº·åº¦è©•ä¼°

**å•é¡Œç™¼ç¾**:

1. **æœªä½¿ç”¨çš„å°å…¥**: `unifiedAuth` è¢«å°å…¥ä½†å®Œå…¨æœªä½¿ç”¨
2. **åŠŸèƒ½é‡è¤‡**: å­˜åœ¨å¦ä¸€å€‹ `ResetForm.tsx` çµ„ä»¶å…·æœ‰å®Œæ•´åŠŸèƒ½å¯¦ç¾
3. **å­¤ç«‹çµ„ä»¶**: `ResetForm.tsx` æœ¬èº«ä¹Ÿæœªè¢«ä»»ä½•åœ°æ–¹ä½¿ç”¨

### 2.3 æ¶æ§‹é—œä¿‚åˆ†æ

```mermaid
graph TD
    A[LoginForm.tsx] -->|Link| B[/main-login/reset/page.tsx]
    C[RefactoredLoginForm.tsx] -->|Link| B
    D[useAuth.ts] -->|Route Config| B
    B -->|Importä½†æœªä½¿ç”¨| E[unified-auth.ts]
    F[ResetForm.tsx] -->|ä½¿ç”¨| E
    F -.->|æœªè¢«ä½¿ç”¨| G[ç³»çµ±å­¤ç«‹çµ„ä»¶]
```

### ä¾è³´åˆ†æçµè«–

**é¢¨éšªç­‰ç´š**: ğŸŸ¡ ä¸­ç­‰
**æ ¸å¿ƒç™¼ç¾**:

- æª”æ¡ˆè¢«å¤šå€‹ç™»å…¥è¡¨å–®å¼•ç”¨ï¼Œä½†åŠŸèƒ½æœªå¯¦ç¾
- å­˜åœ¨åŠŸèƒ½é‡è¤‡çš„çµ„ä»¶ä½†éƒ½æœªå®Œæ•´ä½¿ç”¨
- å±¬æ–¼èªè­‰æµç¨‹çš„ä¸€éƒ¨åˆ†ä½†å¯¦éš›ç„¡ä½œç”¨

---

## æ­¥é©Ÿ 3ï¼šé‹è¡Œæ™‚åˆ†æ (test-automator + error-detective)

### 3.1 åŠŸèƒ½æ¸¬è©¦è©•ä¼°

**æ¸¬è©¦è¦†è“‹**:

- Playwright E2E æ¸¬è©¦æœ‰è¨˜éŒ„æ­¤è·¯ç”±
- ç„¡å–®å…ƒæ¸¬è©¦è¦†è“‹
- ç„¡æ•´åˆæ¸¬è©¦è¦†è“‹

### 3.2 å¯¦éš›åŠŸèƒ½åˆ†æ

**ç•¶å‰è¡Œç‚º**:

1. ç”¨æˆ¶é»æ“Š "Forgot password?" éˆæ¥
2. å°èˆªåˆ° `/main-login/reset` é é¢
3. å¡«å¯«é›»å­éƒµä»¶ä¸¦æäº¤
4. **å‡æˆåŠŸ**: ç›´æ¥é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼Œç„¡å¯¦éš›å‹•ä½œ
5. æ²’æœ‰éƒµä»¶ç™¼é€ï¼Œæ²’æœ‰è³‡æ–™åº«æ“ä½œ

**é æœŸè¡Œç‚º**:

1. æ‡‰è©²èª¿ç”¨ `unifiedAuth.resetPassword(email)`
2. æ‡‰è©²è§¸ç™¼ Supabase ç™¼é€é‡ç½®éƒµä»¶
3. æ‡‰è©²æœ‰é©ç•¶çš„éŒ¯èª¤è™•ç†

### 3.3 éŒ¯èª¤å½±éŸ¿åˆ†æ

**æ½›åœ¨å•é¡Œ**:

1. **ç”¨æˆ¶å›°æƒ‘**: é¡¯ç¤ºæˆåŠŸä½†å¯¦éš›æ²’æœ‰æ”¶åˆ°éƒµä»¶
2. **å®‰å…¨ç–å¿½**: ç”¨æˆ¶ç„¡æ³•é‡ç½®å¯†ç¢¼ï¼Œå¯èƒ½å°è‡´å¸³æˆ¶é–å®š
3. **ä¿¡ä»»å•é¡Œ**: å‡åŠŸèƒ½æå®³ç³»çµ±å¯ä¿¡åº¦

### 3.4 æ›¿ä»£æ–¹æ¡ˆè©•ä¼°

**ç¾æœ‰æ›¿ä»£çµ„ä»¶**:

- `ResetForm.tsx`: åŠŸèƒ½å®Œæ•´ä½†æœªè¢«ä½¿ç”¨
- `unified-auth.resetPassword()`: å¾Œç«¯åŠŸèƒ½å·²å¯¦ç¾

### é‹è¡Œæ™‚åˆ†æçµè«–

**é¢¨éšªç­‰ç´š**: ğŸ”´ é«˜
**é—œéµå•é¡Œ**: åŠŸèƒ½èª¤å°æ€§ï¼Œå½±éŸ¿ç”¨æˆ¶é«”é©—å’Œç³»çµ±å¯ä¿¡åº¦

---

## æ­¥é©Ÿ 4ï¼šå½±éŸ¿è©•ä¼° (security-auditor + performance-engineer)

### 4.1 å®‰å…¨å½±éŸ¿

**å®‰å…¨æ¼æ´**:

1. **å¸³æˆ¶æ¢å¾©å¤±æ•ˆ**: ç”¨æˆ¶ç„¡æ³•é‡ç½®å¿˜è¨˜çš„å¯†ç¢¼
2. **ç¤¾äº¤å·¥ç¨‹é¢¨éšª**: å‡æˆåŠŸè¨Šæ¯å¯èƒ½è¢«åˆ©ç”¨
3. **åˆè¦å•é¡Œ**: å¯†ç¢¼æ¢å¾©æ˜¯åŸºæœ¬å®‰å…¨è¦æ±‚

**å®‰å…¨è©•åˆ†**: 3/10 (åš´é‡ç¼ºé™·)

### 4.2 æ€§èƒ½å½±éŸ¿

**æ€§èƒ½è€ƒé‡**:

- é é¢å¤§å°: ~5KB (æœ€å°å½±éŸ¿)
- ç„¡å¾Œç«¯èª¿ç”¨ (å› ç‚ºåŠŸèƒ½æœªå¯¦ç¾)
- ç„¡æ€§èƒ½ç“¶é ¸

**æ€§èƒ½è©•åˆ†**: N/A (åŠŸèƒ½æœªå¯¦ç¾)

### 4.3 ç”¨æˆ¶é«”é©—å½±éŸ¿

**UX å•é¡Œ**:

1. **åŠŸèƒ½å¤±æ•ˆ**: æ ¸å¿ƒåŠŸèƒ½ç„¡æ³•ä½¿ç”¨
2. **èª¤å°è¨Šæ¯**: å‡æˆåŠŸè¨Šæ¯é€ æˆå›°æƒ‘
3. **ä¿¡ä»»æå¤±**: ç™¼ç¾åŠŸèƒ½ç„¡æ•ˆå¾Œå¤±å»ä¿¡ä»»

**UX è©•åˆ†**: 1/10 (å®Œå…¨å¤±æ•—)

### 4.4 æ¥­å‹™å½±éŸ¿

**æ¥­å‹™é¢¨éšª**:

1. **æ”¯æ´æˆæœ¬**: ç”¨æˆ¶ç„¡æ³•è‡ªåŠ©é‡ç½®å¯†ç¢¼
2. **ç”Ÿç”¢åŠ›æå¤±**: å“¡å·¥ç„¡æ³•å­˜å–ç³»çµ±
3. **åˆè¦é¢¨éšª**: å¯èƒ½é•åå®‰å…¨æ¨™æº–

### å½±éŸ¿è©•ä¼°çµè«–

**ç¸½é«”é¢¨éšª**: ğŸ”´ é«˜
**å»ºè­°**: éœ€è¦ç«‹å³ä¿®å¾©æˆ–ç§»é™¤

---

## æ­¥é©Ÿ 5ï¼šæœ€çµ‚å»ºè­° (docs-architect)

### 5.1 å•é¡Œç¸½çµ

**é—œéµå•é¡Œæ¸…å–®**:

1. âŒ å¯†ç¢¼é‡ç½®åŠŸèƒ½å®Œå…¨æœªå¯¦ç¾
2. âŒ é¡¯ç¤ºèª¤å°æ€§æˆåŠŸè¨Šæ¯
3. âŒ æœªä½¿ç”¨å·²å­˜åœ¨çš„ `unifiedAuth.resetPassword()` æ–¹æ³•
4. âŒ å­˜åœ¨åŠŸèƒ½é‡è¤‡çš„ `ResetForm.tsx` çµ„ä»¶
5. âŒ å½±éŸ¿ç³»çµ±æ ¸å¿ƒå®‰å…¨åŠŸèƒ½

### 5.2 æ¸…ç†æ±ºç­–

**æ±ºç­–**: ğŸš« **ä¸å»ºè­°åˆªé™¤**

**ç†ç”±**:

1. æ­¤é é¢è¢«å¤šå€‹ç™»å…¥è¡¨å–®ç›´æ¥éˆæ¥
2. æ˜¯èªè­‰æµç¨‹çš„æ¨™æº–çµ„æˆéƒ¨åˆ†
3. åˆªé™¤æœƒé€ æˆè·¯ç”±æ–·è£‚å’Œ 404 éŒ¯èª¤
4. ç”¨æˆ¶é æœŸæ­¤åŠŸèƒ½å­˜åœ¨

### 5.3 å»ºè­°è¡Œå‹•æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šç«‹å³ä¿®å¾©ï¼ˆæ¨è–¦ï¼‰â­

**å¯¦æ–½æ­¥é©Ÿ**:

```typescript
// ä¿®æ”¹ handleSubmit å‡½æ•¸
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();

  if (!email) {
    setError('Please enter your email address');
    return;
  }

  if (!email.endsWith('@pennineindustries.com')) {
    setError('Only @pennineindustries.com email addresses are allowed');
    return;
  }

  setIsLoading(true);
  setError('');

  try {
    // ä½¿ç”¨å·²å­˜åœ¨çš„ unifiedAuth æ–¹æ³•
    await unifiedAuth.resetPassword(email);
    setSuccess(true);
  } catch (err: unknown) {
    setError(err instanceof Error ? err.message : 'Failed to send reset email');
  } finally {
    setIsLoading(false);
  }
};
```

**å„ªé»**:

- å¿«é€Ÿä¿®å¾©ï¼Œæœ€å°æ”¹å‹•
- ä¿æŒç¾æœ‰ UI å’Œè·¯ç”±çµæ§‹
- åˆ©ç”¨å·²å¯¦ç¾çš„å¾Œç«¯åŠŸèƒ½

**é ä¼°å·¥æ™‚**: 30 åˆ†é˜

#### æ–¹æ¡ˆ Bï¼šæ•´åˆ ResetForm çµ„ä»¶

**å¯¦æ–½æ­¥é©Ÿ**:

1. å°‡ `ResetForm.tsx` æ•´åˆåˆ° reset/page.tsx
2. ç§»é™¤é‡è¤‡ä»£ç¢¼
3. çµ±ä¸€è¡¨å–®è™•ç†é‚è¼¯

**å„ªé»**:

- æ¸›å°‘ä»£ç¢¼é‡è¤‡
- çµ±ä¸€ç¶­è­·é»
- æ›´å®Œæ•´çš„åŠŸèƒ½å¯¦ç¾

**ç¼ºé»**:

- éœ€è¦æ›´å¤šæ¸¬è©¦
- å¯èƒ½å½±éŸ¿ç¾æœ‰ UI

**é ä¼°å·¥æ™‚**: 2 å°æ™‚

#### æ–¹æ¡ˆ Cï¼šè‡¨æ™‚é‡å®šå‘

**å¯¦æ–½æ­¥é©Ÿ**:

```typescript
// åœ¨ reset/page.tsx ä¸­æ·»åŠ é‡å®šå‘
import { redirect } from 'next/navigation';

export default function ResetPasswordPage() {
  // è‡¨æ™‚é‡å®šå‘åˆ°å…¶ä»–å¯†ç¢¼é‡ç½®æ–¹æ¡ˆ
  redirect('/main-login?reset=true');
}
```

**å„ªé»**:

- ç«‹å³è§£æ±ºå•é¡Œ
- é›¶é¢¨éšª

**ç¼ºé»**:

- éæ°¸ä¹…è§£æ±ºæ–¹æ¡ˆ
- ç”¨æˆ¶é«”é©—é™ç´š

**é ä¼°å·¥æ™‚**: 5 åˆ†é˜

### 5.4 å¯¦æ–½å„ªå…ˆç´š

**ç·Šæ€¥åº¦**: ğŸ”´ **é«˜**
**é‡è¦æ€§**: ğŸ”´ **é«˜**

**å»ºè­°æ™‚é–“ç·š**:

- **ç«‹å³**: å¯¦æ–½æ–¹æ¡ˆ Cï¼ˆè‡¨æ™‚æªæ–½ï¼‰
- **æœ¬é€±å…§**: å¯¦æ–½æ–¹æ¡ˆ Aï¼ˆæ°¸ä¹…ä¿®å¾©ï¼‰
- **ä¸‹å€‹è¿­ä»£**: è€ƒæ…®æ–¹æ¡ˆ Bï¼ˆæ¶æ§‹å„ªåŒ–ï¼‰

### 5.5 é©—è­‰æª¢æŸ¥æ¸…å–®

ä¿®å¾©å¾Œéœ€é©—è­‰ï¼š

- [ ] å¯†ç¢¼é‡ç½®éƒµä»¶æˆåŠŸç™¼é€
- [ ] éŒ¯èª¤è™•ç†æ­£ç¢ºé¡¯ç¤º
- [ ] é›»å­éƒµä»¶åŸŸåé©—è­‰æœ‰æ•ˆ
- [ ] æˆåŠŸè¨Šæ¯æº–ç¢ºåæ˜ å¯¦éš›ç‹€æ…‹
- [ ] E2E æ¸¬è©¦é€šé
- [ ] å®‰å…¨å¯©è¨ˆé€šé

### 5.6 ç›¸é—œæª”æ¡ˆæ¸…ç†å»ºè­°

**å¯ä½µåŒè™•ç†**:

1. `/app/(auth)/main-login/components/ResetForm.tsx` - æœªä½¿ç”¨ï¼Œå¯è€ƒæ…®åˆªé™¤æˆ–æ•´åˆ
2. ç§»é™¤ reset/page.tsx ä¸­æœªä½¿ç”¨çš„ `unifiedAuth` importï¼ˆå¦‚æœä¸æ¡ç”¨ä¿®å¾©æ–¹æ¡ˆï¼‰

---

## æœ€çµ‚çµè«–

### æ¸…ç†æ±ºç­–è¡¨

| é …ç›®         | ç‹€æ…‹ | å»ºè­°             |
| ------------ | ---- | ---------------- |
| **æª”æ¡ˆåˆªé™¤** | âŒ   | ä¸å»ºè­°åˆªé™¤       |
| **åŠŸèƒ½ä¿®å¾©** | âœ…   | å¼·çƒˆå»ºè­°ç«‹å³ä¿®å¾© |
| **ä»£ç¢¼é‡æ§‹** | âš ï¸   | å¯é¸ï¼Œè¦–è³‡æºè€Œå®š |
| **ç·Šæ€¥ç¨‹åº¦** | ğŸ”´   | é«˜å„ªå…ˆç´š         |

### åŸ·è¡ŒæŒ‡ä»¤ï¼ˆå¦‚æ¡ç´ä¿®å¾©æ–¹æ¡ˆ Aï¼‰

```bash
# 1. å‚™ä»½ç¾æœ‰æª”æ¡ˆ
cp app/(auth)/main-login/reset/page.tsx \
   Backup/reset-page-backup-$(date +%Y%m%d_%H%M%S).tsx

# 2. å¯¦æ–½ä¿®å¾©ï¼ˆæ‰‹å‹•ç·¨è¼¯æˆ–ä½¿ç”¨æä¾›çš„ä»£ç¢¼ï¼‰

# 3. åŸ·è¡Œæ¸¬è©¦
npm run test:e2e -- --grep "password reset"

# 4. é©—è­‰åŠŸèƒ½
# æ‰‹å‹•æ¸¬è©¦å¯†ç¢¼é‡ç½®æµç¨‹
```

### æ–‡æª”æ›´æ–°éœ€æ±‚

å¦‚æœå¯¦æ–½ä¿®å¾©ï¼š

1. æ›´æ–°èªè­‰æµç¨‹æ–‡æª”
2. æ·»åŠ å¯†ç¢¼é‡ç½® API æ–‡æª”
3. æ›´æ–°æ¸¬è©¦æ¡ˆä¾‹æ–‡æª”

---

**åˆ†æå®Œæˆæ™‚é–“**: 2025-08-31
**åˆ†æç‹€æ…‹**: âœ… å®Œæˆ
**ä¸‹ä¸€æ­¥è¡Œå‹•**: å¯¦æ–½æ–¹æ¡ˆ A - ç«‹å³ä¿®å¾©åŠŸèƒ½
