# Export All Data åŠŸèƒ½å¯¦è£æ–‡æª”

> **å¯¦è£æ—¥æœŸ**: 2025å¹´1æœˆ25æ—¥  
> **åŠŸèƒ½ç‹€æ…‹**: âœ… å·²å®Œæˆ  
> **ä½ç½®**: Admin Panel > Export Reports > Export All Data  
> **æœ€å¾Œæ›´æ–°**: 2025å¹´1æœˆ25æ—¥ - ç•Œé¢èªè¨€æ”¹ç‚ºè‹±æ–‡ï¼Œä¿®æ­£ç•Œé¢é‡ç½®å•é¡Œ

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

Export All Data åŠŸèƒ½å…è¨±ç”¨æˆ¶å¾ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡å¤šå€‹æ•¸æ“šåº«è¡¨æ ¼ï¼Œä¸¦ä»¥ CSV æ ¼å¼æ‰¹é‡å°å‡ºæ•¸æ“šã€‚æ­¤åŠŸèƒ½å–ä»£äº†åŸæœ‰çš„ Export Code List å’Œ Export Inventory Transaction åŠŸèƒ½ï¼Œæä¾›æ›´éˆæ´»å’Œå…¨é¢çš„æ•¸æ“šå°å‡ºè§£æ±ºæ–¹æ¡ˆã€‚

## ğŸ¯ ä¸»è¦ç‰¹æ€§

### 1. è¡¨æ ¼é¸æ“‡
ç”¨æˆ¶å¯ä»¥å¾ä»¥ä¸‹è¡¨æ ¼ä¸­é¸æ“‡è¦å°å‡ºçš„æ•¸æ“šï¼š

| è¡¨æ ¼åç¨± | å°æ‡‰ Supabase è¡¨æ ¼ | æè¿° | ç‰¹æ®Šè¦æ±‚ |
|---------|-------------------|------|----------|
| **Pallet Information** | `record_palletinfo` | æ‰˜ç›¤è³‡è¨Šè¨˜éŒ„ | - |
| **Code List** | `data_code` | ç”¢å“ä»£ç¢¼æ¸…å–® | - |
| **Voided Inventory** | `report_void` | ä½œå»¢åº«å­˜è¨˜éŒ„ | - |
| **Operation History** | `record_history` | æ“ä½œæ­·å²è¨˜éŒ„ | ğŸ—“ï¸ éœ€è¦æ—¥æœŸç¯„åœ |
| **Full Inventory** | `record_inventory` | å®Œæ•´åº«å­˜è¨˜éŒ„ | ğŸ—“ï¸ éœ€è¦æ—¥æœŸç¯„åœ |

### 2. æ—¥æœŸç¯„åœé™åˆ¶
- **é©ç”¨è¡¨æ ¼**: Operation History å’Œ Full Inventory
- **æœ€å¤§ç¯„åœ**: ä¸€å€‹æœˆï¼ˆ31å¤©ï¼‰
- **é©—è­‰æ©Ÿåˆ¶**: è‡ªå‹•æª¢æŸ¥æ—¥æœŸç¯„åœï¼Œè¶…éé™åˆ¶æ™‚é¡¯ç¤ºè­¦å‘Š
- **UI æç¤º**: æ©™è‰²æ¨™ç±¤æ¨™ç¤ºéœ€è¦æ—¥æœŸç¯„åœçš„è¡¨æ ¼

### 3. ç•Œé¢é‡ç½®æ©Ÿåˆ¶
- **æ‰“é–‹å°è©±æ¡†æ™‚**: è‡ªå‹•é‡ç½®æ‰€æœ‰é¸æ“‡ç‹€æ…‹
- **é—œé–‰å°è©±æ¡†æ™‚**: æ¸…é™¤æ‰€æœ‰è¼¸å…¥å’Œé¸æ“‡
- **æˆåŠŸç”Ÿæˆå ±å‘Šå¾Œ**: è‡ªå‹•é—œé–‰å°è©±æ¡†ä¸¦é‡ç½®ç‹€æ…‹
- **ç¢ºä¿ç”¨æˆ¶é«”é©—**: æ¯æ¬¡æ“ä½œéƒ½æ˜¯å…¨æ–°çš„é–‹å§‹ï¼Œä¸æœƒé¡¯ç¤ºä¸Šä¸€æ¬¡çš„é¸æ“‡

### 4. æ™ºèƒ½æ’åº
ç³»çµ±æ ¹æ“šä¸åŒè¡¨æ ¼è‡ªå‹•é¸æ“‡æœ€é©åˆçš„æ’åºæ¬„ä½ï¼š

```typescript
// æ’åºé‚è¼¯
let sortField = 'id'; // é è¨­
if (tableName === 'record_palletinfo') {
  sortField = 'generate_time';
} else if (tableName === 'data_code') {
  sortField = 'code';
} else if (tableName === 'report_void') {
  sortField = 'time';
} else if (tableName === 'record_history') {
  sortField = 'time';
} else if (tableName === 'record_inventory') {
  sortField = 'latest_update';
}
```

### 5. éŒ¯èª¤è™•ç†
- **æ’åºå¤±æ•—**: è‡ªå‹•å›é€€åˆ°ç„¡æ’åºæŸ¥è©¢
- **è¡¨æ ¼ç„¡æ•¸æ“š**: é¡¯ç¤ºè­¦å‘Šä½†ç¹¼çºŒè™•ç†å…¶ä»–è¡¨æ ¼
- **æŸ¥è©¢éŒ¯èª¤**: è¨˜éŒ„è­¦å‘Šä¸¦è·³éè©²è¡¨æ ¼

## ğŸ¨ ç”¨æˆ¶ç•Œé¢è¨­è¨ˆ

### ç•Œé¢èªè¨€
- **ä¸»è¦èªè¨€**: è‹±æ–‡
- **æ¨™ç±¤æ–‡å­—**: 
  - "Select Tables to Export"
  - "Requires Date Range"
  - "Date Range Settings"
  - "Start Date" / "End Date"
  - "Date range cannot exceed one month"

### è¡¨æ ¼é¸æ“‡ç•Œé¢
- **è¨­è¨ˆé¢¨æ ¼**: æ·±è‰²ä¸»é¡Œï¼Œç¿ ç¶ è‰²æ¼¸å±¤èƒŒæ™¯
- **äº¤äº’å…ƒç´ **: 
  - è¤‡é¸æ¡†é¸æ“‡è¡¨æ ¼
  - æ©™è‰²æ¨™ç±¤æ¨™ç¤ºéœ€è¦æ—¥æœŸç¯„åœçš„è¡¨æ ¼
  - æ‡¸åœæ•ˆæœå’Œéæ¸¡å‹•ç•«

### æ—¥æœŸç¯„åœè¨­å®š
- **è§¸ç™¼æ¢ä»¶**: é¸æ“‡ Operation History æˆ– Full Inventory æ™‚è‡ªå‹•é¡¯ç¤º
- **è¦–è¦ºè¨­è¨ˆ**: æ©™è‰²ä¸»é¡Œå€å¡Šï¼ŒåŒ…å«è­¦å‘Šåœ–æ¨™å’Œèªªæ˜æ–‡å­—
- **é©—è­‰æç¤º**: å³æ™‚æª¢æŸ¥æ—¥æœŸç¯„åœï¼Œè¶…éä¸€å€‹æœˆæ™‚é¡¯ç¤º toast è­¦å‘Š

### ç•Œé¢é‡ç½®è¡Œç‚º
```typescript
// æ‰“é–‹å°è©±æ¡†æ™‚é‡ç½®æ‰€æœ‰ç‹€æ…‹
const handleReportClick = async (reportType: string) => {
  // Reset all states first
  setSelectedTables([]);
  setNeedsDateRange(false);
  setStartDate('');
  setEndDate('');
  setSelectedAcoOrder('');
  setSelectedGrnRef('');
  setAvailableAcoOrders([]);
  setAvailableGrnRefs([]);
  
  setCurrentReportType(reportType);
  setShowReportDialog(true);
  // ...
};
```

### æ–‡ä»¶å‘½åè¦å‰‡
```
{è¡¨æ ¼åç¨±}_{é–‹å§‹æ—¥æœŸ}_to_{çµæŸæ—¥æœŸ}_{ç•¶å‰æ—¥æœŸ}.csv
```

ä¾‹å¦‚ï¼š
- `record_history_2025-01-01_to_2025-01-31_2025-01-25.csv`
- `data_code_2025-01-25.csv`

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### æ ¸å¿ƒå‡½æ•¸
```typescript
const generateAllDataReport = async () => {
  try {
    for (const tableName of selectedTables) {
      // 1. æ§‹å»ºæŸ¥è©¢
      let query = supabase.from(tableName).select('*');
      
      // 2. æ·»åŠ æ—¥æœŸç¯„åœéæ¿¾
      if (needsDateRange && (tableName === 'record_history' || tableName === 'record_inventory')) {
        const timeField = tableName === 'record_history' ? 'time' : 'latest_update';
        query = query
          .gte(timeField, startDate)
          .lte(timeField, endDate + 'T23:59:59');
      }
      
      // 3. åŸ·è¡ŒæŸ¥è©¢ï¼ˆå«éŒ¯èª¤è™•ç†ï¼‰
      // 4. ç”Ÿæˆ CSV å…§å®¹
      // 5. ä¸‹è¼‰æ–‡ä»¶
    }
  } catch (error) {
    // éŒ¯èª¤è™•ç†
  }
};
```

### ç‹€æ…‹ç®¡ç†
```typescript
// æ–°å¢çš„ç‹€æ…‹è®Šæ•¸
const [selectedTables, setSelectedTables] = useState<string[]>([]);
const [needsDateRange, setNeedsDateRange] = useState<boolean>(false);
```

### ç•Œé¢é‡ç½®é‚è¼¯
```typescript
// é—œé–‰å°è©±æ¡†æ™‚å®Œå…¨é‡ç½®
const closeReportDialog = () => {
  setShowReportDialog(false);
  setCurrentReportType('');
  setSelectedAcoOrder('');
  setSelectedGrnRef('');
  setAvailableAcoOrders([]);
  setAvailableGrnRefs([]);
  setStartDate('');
  setEndDate('');
  // Reset All Data Export states
  setSelectedTables([]);
  setNeedsDateRange(false);
};
```

### CSV ç”Ÿæˆé‚è¼¯
- **æ¨™é ­è™•ç†**: è‡ªå‹•æå–ç¬¬ä¸€è¡Œæ•¸æ“šçš„éµä½œç‚º CSV æ¨™é ­
- **æ•¸æ“šè½‰æ›**: è™•ç† null/undefined å€¼ï¼Œè½‰ç¾©åŒ…å«é€—è™Ÿçš„å­—ç¬¦ä¸²
- **ç·¨ç¢¼**: ä½¿ç”¨ UTF-8 ç·¨ç¢¼ç¢ºä¿ä¸­æ–‡å­—ç¬¦æ­£ç¢ºé¡¯ç¤º

## ğŸ“Š åŠŸèƒ½æµç¨‹

```mermaid
graph TD
    A[é»æ“Š Export All Data] --> B[é‡ç½®æ‰€æœ‰ç‹€æ…‹]
    B --> C[é¡¯ç¤ºè¡¨æ ¼é¸æ“‡å°è©±æ¡†]
    C --> D{é¸æ“‡è¡¨æ ¼}
    D --> E{åŒ…å«éœ€è¦æ—¥æœŸç¯„åœçš„è¡¨æ ¼?}
    E -->|æ˜¯| F[é¡¯ç¤ºæ—¥æœŸç¯„åœè¨­å®š]
    E -->|å¦| G[é»æ“Š Generate Report]
    F --> H[è¨­å®šæ—¥æœŸç¯„åœ]
    H --> I{æ—¥æœŸç¯„åœ â‰¤ 1å€‹æœˆ?}
    I -->|å¦| J[é¡¯ç¤ºè­¦å‘Š]
    I -->|æ˜¯| G
    J --> H
    G --> K[é–‹å§‹ç”Ÿæˆå ±å‘Š]
    K --> L[é€å€‹è™•ç†é¸ä¸­çš„è¡¨æ ¼]
    L --> M[æŸ¥è©¢æ•¸æ“š]
    M --> N[ç”Ÿæˆ CSV]
    N --> O[ä¸‹è¼‰æ–‡ä»¶]
    O --> P{é‚„æœ‰å…¶ä»–è¡¨æ ¼?}
    P -->|æ˜¯| L
    P -->|å¦| Q[é—œé–‰å°è©±æ¡†ä¸¦é‡ç½®ç‹€æ…‹]
    Q --> R[é¡¯ç¤ºæˆåŠŸæç¤º]
```

## ğŸš€ æ”¹é€²å…§å®¹

### ç§»é™¤çš„åŠŸèƒ½
- âŒ Export Code Listï¼ˆç¨ç«‹åŠŸèƒ½ï¼‰
- âŒ Export Inventory Transactionï¼ˆç¨ç«‹åŠŸèƒ½ï¼‰

### æ–°å¢çš„åŠŸèƒ½
- âœ… å¤šè¡¨æ ¼é¸æ“‡å°å‡º
- âœ… æ™ºèƒ½æ—¥æœŸç¯„åœé©—è­‰
- âœ… è‡ªé©æ‡‰æ’åºé‚è¼¯
- âœ… æ‰¹é‡æ–‡ä»¶ä¸‹è¼‰
- âœ… éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
- âœ… å®Œæ•´çš„ç•Œé¢é‡ç½®æ©Ÿåˆ¶

### UI/UX æ”¹é€²
- âœ… ç¾ä»£åŒ–çš„æ·±è‰²ä¸»é¡Œè¨­è¨ˆ
- âœ… ç›´è§€çš„è¡¨æ ¼é¸æ“‡ç•Œé¢
- âœ… æ¸…æ™°çš„æ—¥æœŸç¯„åœæç¤º
- âœ… å³æ™‚é©—è­‰å’Œåé¥‹
- âœ… ç•Œé¢èªè¨€çµ±ä¸€ç‚ºè‹±æ–‡
- âœ… æ¯æ¬¡æ“ä½œéƒ½æ˜¯å…¨æ–°é–‹å§‹ï¼Œç„¡æ®˜ç•™ç‹€æ…‹

## ğŸ“ ä½¿ç”¨èªªæ˜

### åŸºæœ¬æ“ä½œ
1. åœ¨ Admin Panel ä¸­é»æ“Š "Export Reports" é¡åˆ¥
2. é¸æ“‡ "Export All Data"
3. åœ¨å°è©±æ¡†ä¸­å‹¾é¸è¦å°å‡ºçš„è¡¨æ ¼
4. å¦‚æœé¸æ“‡äº†éœ€è¦æ—¥æœŸç¯„åœçš„è¡¨æ ¼ï¼Œè¨­å®šé–‹å§‹å’ŒçµæŸæ—¥æœŸ
5. é»æ“Š "Generate Report" é–‹å§‹å°å‡º
6. ç³»çµ±å°‡è‡ªå‹•ä¸‹è¼‰é¸ä¸­è¡¨æ ¼çš„ CSV æ–‡ä»¶
7. å°è©±æ¡†è‡ªå‹•é—œé–‰ä¸¦é‡ç½®æ‰€æœ‰ç‹€æ…‹

### æ³¨æ„äº‹é …
- ğŸ“… Operation History å’Œ Full Inventory è¡¨æ ¼å¿…é ˆè¨­å®šæ—¥æœŸç¯„åœ
- â° æ—¥æœŸç¯„åœæœ€å¤šä¸èƒ½è¶…éä¸€å€‹æœˆ
- ğŸ“ æ¯å€‹è¡¨æ ¼æœƒç”Ÿæˆç¨ç«‹çš„ CSV æ–‡ä»¶
- ğŸ”„ æ–‡ä»¶ä¸‹è¼‰ä¹‹é–“æœ‰ 500ms çš„å»¶é²ï¼Œé¿å…ç€è¦½å™¨é˜»æ“‹
- ğŸ”„ æ¯æ¬¡æ‰“é–‹å°è©±æ¡†éƒ½æ˜¯å…¨æ–°ç‹€æ…‹ï¼Œä¸æœƒé¡¯ç¤ºä¸Šä¸€æ¬¡çš„é¸æ“‡

## ğŸ” æ¸¬è©¦å»ºè­°

### åŠŸèƒ½æ¸¬è©¦
- [ ] é¸æ“‡å–®å€‹è¡¨æ ¼å°å‡º
- [ ] é¸æ“‡å¤šå€‹è¡¨æ ¼æ‰¹é‡å°å‡º
- [ ] æ¸¬è©¦æ—¥æœŸç¯„åœé©—è­‰ï¼ˆè¶…éä¸€å€‹æœˆï¼‰
- [ ] æ¸¬è©¦ç©ºæ•¸æ“šè¡¨æ ¼çš„è™•ç†
- [ ] æ¸¬è©¦ç¶²çµ¡éŒ¯èª¤çš„è™•ç†
- [ ] æ¸¬è©¦ç•Œé¢é‡ç½®åŠŸèƒ½ï¼ˆæ‰“é–‹/é—œé–‰å°è©±æ¡†ï¼‰
- [ ] æ¸¬è©¦æˆåŠŸç”Ÿæˆå ±å‘Šå¾Œçš„ç‹€æ…‹é‡ç½®

### UI æ¸¬è©¦
- [ ] è¡¨æ ¼é¸æ“‡çš„è¦–è¦ºåé¥‹
- [ ] æ—¥æœŸç¯„åœå€å¡Šçš„é¡¯ç¤º/éš±è—
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„è¡¨ç¾
- [ ] æ·±è‰²ä¸»é¡Œçš„ä¸€è‡´æ€§
- [ ] è‹±æ–‡ç•Œé¢æ–‡å­—çš„æ­£ç¢ºæ€§
- [ ] ç•Œé¢é‡ç½®çš„å®Œæ•´æ€§

## ğŸ“ˆ æœªä¾†æ“´å±•

### å¯èƒ½çš„æ”¹é€²æ–¹å‘
1. **æ–‡ä»¶æ ¼å¼æ”¯æŒ**: æ·»åŠ  Excel (.xlsx) æ ¼å¼å°å‡º
2. **æ•¸æ“šé è¦½**: åœ¨å°å‡ºå‰æä¾›æ•¸æ“šé è¦½åŠŸèƒ½
3. **è‡ªå®šç¾©æ¬„ä½**: å…è¨±ç”¨æˆ¶é¸æ“‡è¦å°å‡ºçš„ç‰¹å®šæ¬„ä½
4. **æ’ç¨‹å°å‡º**: æ”¯æŒå®šæ™‚è‡ªå‹•å°å‡ºåŠŸèƒ½
5. **å£“ç¸®ä¸‹è¼‰**: å¤šå€‹æ–‡ä»¶æ‰“åŒ…ç‚º ZIP ä¸‹è¼‰

### æ€§èƒ½å„ªåŒ–
1. **åˆ†é æŸ¥è©¢**: å°å¤§æ•¸æ“šé‡è¡¨æ ¼å¯¦æ–½åˆ†é æŸ¥è©¢
2. **å¾Œå°è™•ç†**: å°‡å¤§å‹å°å‡ºä»»å‹™ç§»è‡³å¾Œå°è™•ç†
3. **é€²åº¦æŒ‡ç¤º**: æ·»åŠ å°å‡ºé€²åº¦æ¢é¡¯ç¤º

---

> **é–‹ç™¼è€…**: Assistant  
> **å¯©æ ¸è€…**: å¾…å®š  
> **ç‰ˆæœ¬**: 1.1.0  
> **æœ€å¾Œæ›´æ–°**: 2025å¹´1æœˆ25æ—¥ 