# NewPennine WMS ç›£æ§å’Œç¶­è­·æŒ‡å—

**ç‰ˆæœ¬**: v2.0.7  
**æ—¥æœŸ**: 2025-07-17  
**ç¶­è­·è€…**: DevOps & Performance Team  
**ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’

## æ¦‚è¿°

æœ¬æŒ‡å—æä¾› NewPennine å€‰åº«ç®¡ç†ç³»çµ±å˜…å®Œæ•´ç›£æ§å’Œç¶­è­·æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç›£æ§ç³»çµ±ä½¿ç”¨ã€å‘Šè­¦é…ç½®ç®¡ç†ã€ç³»çµ±å¥åº·æª¢æŸ¥åŒæ—¥å¸¸ç¶­è­·ç¨‹åºã€‚åŸºæ–¼ v2.0.7 å·²å®Œæˆå˜…ç›£æ§å‘Šè­¦ç³»çµ±æ¶æ§‹ã€‚

## ç›£æ§ç³»çµ±æ¶æ§‹

### 1. ç›£æ§å±¤æ¬¡çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ¶ç•Œé¢ç›£æ§å±¤                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‘Šè­¦å„€è¡¨æ¿ â”‚ æ€§èƒ½ç›£æ§ â”‚ ç”¨æˆ¶æ´»å‹• â”‚ ç³»çµ±ç‹€æ…‹ â”‚ éŒ¯èª¤è¿½è¹¤    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‡‰ç”¨ç›£æ§å±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éŸ¿æ‡‰æ™‚é–“ â”‚ éŒ¯èª¤ç‡ â”‚ ååé‡ â”‚ è³‡æºä½¿ç”¨ â”‚ æ¥­å‹™æŒ‡æ¨™         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¤è¨­æ–½ç›£æ§å±¤                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç³»çµ±è³‡æº â”‚ æ•¸æ“šåº« â”‚ ç¶²çµ¡ â”‚ å­˜å„² â”‚ å®¹å™¨ â”‚ æœå‹™ç‹€æ…‹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•¸æ“šæ”¶é›†å±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Health APIs â”‚ Metrics APIs â”‚ Logs â”‚ Traces â”‚ Events        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç›£æ§çµ„ä»¶

#### æ ¸å¿ƒç›£æ§ API ç«¯é»
- **åŸºæœ¬å¥åº·æª¢æŸ¥**: `GET /api/v1/health`
- **é€²éšå¥åº·æª¢æŸ¥**: `GET /api/v2/health`
- **æ€§èƒ½æŒ‡æ¨™**: `GET /api/v1/metrics`
- **ç·©å­˜æŒ‡æ¨™**: `GET /api/v1/cache/metrics`
- **ç³»çµ±æŒ‡æ¨™**: `GET /api/v1/system/metrics`

#### å‘Šè­¦ç³»çµ±çµ„ä»¶
- **å‘Šè­¦è¦å‰‡å¼•æ“**: `lib/alerts/core/AlertRuleEngine.ts`
- **é€šçŸ¥æœå‹™**: `lib/alerts/notifications/NotificationService.ts`
- **ç‹€æ…‹ç®¡ç†**: `lib/alerts/core/AlertStateManager.ts`
- **ç›£æ§æœå‹™**: `lib/alerts/services/AlertMonitoringService.ts`

## å¥åº·æª¢æŸ¥ç³»çµ±

### 1. åŸºæœ¬å¥åº·æª¢æŸ¥ (v1)

```bash
# æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼åŸºæœ¬ç‹€æ…‹
curl -s http://localhost:3000/api/v1/health | jq '.'

# é æœŸéŸ¿æ‡‰
{
  "status": "healthy",
  "timestamp": "2025-07-17T10:00:00Z",
  "uptime": "2d 4h 32m",
  "version": "v2.0.7",
  "environment": "production"
}
```

### 2. é€²éšå¥åº·æª¢æŸ¥ (v2)

```bash
# æª¢æŸ¥è©³ç´°ç³»çµ±ç‹€æ…‹
curl -s http://localhost:3000/api/v2/health | jq '.'

# é æœŸéŸ¿æ‡‰
{
  "status": "healthy",
  "timestamp": "2025-07-17T10:00:00Z",
  "services": {
    "database": {
      "status": "healthy",
      "responseTime": "15ms",
      "connections": 12
    },
    "cache": {
      "status": "healthy",
      "hitRate": "95.2%",
      "memory": "128MB"
    },
    "storage": {
      "status": "healthy",
      "freeSpace": "75%",
      "iops": "normal"
    }
  },
  "performance": {
    "cpuUsage": "45%",
    "memoryUsage": "62%",
    "diskUsage": "38%"
  }
}
```

### 3. æ€§èƒ½æŒ‡æ¨™ç›£æ§

```bash
# ç²å–è©³ç´°æ€§èƒ½æŒ‡æ¨™
curl -s http://localhost:3000/api/v1/metrics | jq '.'

# é—œéµæŒ‡æ¨™
{
  "api_response_time": {
    "avg": "120ms",
    "p95": "250ms",
    "p99": "500ms"
  },
  "database_query_time": {
    "avg": "45ms",
    "slow_queries": 3
  },
  "error_rate": "0.02%",
  "active_users": 15,
  "memory_usage": "512MB",
  "cpu_usage": "45%"
}
```

## å‘Šè­¦ç³»çµ±é…ç½®

### 1. é è¨­å‘Šè­¦è¦å‰‡

ç³»çµ±åŒ…å« 7 å€‹é è¨­å‘Šè­¦è¦å‰‡ï¼š

#### é«˜ API éŸ¿æ‡‰æ™‚é–“ (Warning)
```json
{
  "name": "High API Response Time",
  "level": "warning",
  "metric": "api_response_time",
  "condition": "greater_than",
  "threshold": 2000,
  "timeWindow": 30,
  "evaluationInterval": 30
}
```

#### é—œéµ API éŸ¿æ‡‰æ™‚é–“ (Critical)
```json
{
  "name": "Critical API Response Time",
  "level": "critical",
  "metric": "api_response_time",
  "condition": "greater_than",
  "threshold": 5000,
  "timeWindow": 30,
  "evaluationInterval": 30
}
```

#### é«˜éŒ¯èª¤ç‡ (Error)
```json
{
  "name": "High Error Rate",
  "level": "error",
  "metric": "error_rate",
  "condition": "greater_than",
  "threshold": 5,
  "timeWindow": 60,
  "evaluationInterval": 60
}
```

### 2. å‘Šè­¦é…ç½®ç®¡ç†

#### å‰µå»ºè‡ªå®šç¾©å‘Šè­¦è¦å‰‡
```bash
# å‰µå»ºæ–°å‘Šè­¦è¦å‰‡
curl -X POST http://localhost:3000/api/v1/alerts/rules \
  -H "Content-Type: application/json" \
  -d '{
    "name": "High Memory Usage",
    "description": "Alert when memory usage exceeds 85%",
    "level": "warning",
    "metric": "memory_usage",
    "condition": "greater_than",
    "threshold": 85,
    "timeWindow": 300,
    "evaluationInterval": 60,
    "notifications": [
      {
        "channel": "email",
        "config": {
          "recipients": ["ops@newpennine.com"]
        }
      }
    ]
  }'
```

#### ç®¡ç†å‘Šè­¦è¦å‰‡
```bash
# åˆ—å‡ºæ‰€æœ‰è¦å‰‡
curl -s http://localhost:3000/api/v1/alerts/rules | jq '.'

# ç²å–ç‰¹å®šè¦å‰‡
curl -s http://localhost:3000/api/v1/alerts/rules/rule-id | jq '.'

# æ›´æ–°è¦å‰‡
curl -X PUT http://localhost:3000/api/v1/alerts/rules/rule-id \
  -H "Content-Type: application/json" \
  -d '{"threshold": 90}'

# åˆªé™¤è¦å‰‡
curl -X DELETE http://localhost:3000/api/v1/alerts/rules/rule-id
```

### 3. é€šçŸ¥é…ç½®

#### Email é€šçŸ¥è¨­ç½®
```json
{
  "notifications": [
    {
      "channel": "email",
      "config": {
        "recipients": ["admin@newpennine.com", "ops@newpennine.com"],
        "subject": "NewPennine WMS Alert: {{alert.name}}",
        "template": "alert_email_template"
      }
    }
  ]
}
```

#### Slack é€šçŸ¥è¨­ç½®
```json
{
  "notifications": [
    {
      "channel": "slack",
      "config": {
        "webhook_url": "https://hooks.slack.com/services/...",
        "channel": "#newpennine-alerts",
        "username": "NewPennine WMS",
        "icon_emoji": ":warning:"
      }
    }
  ]
}
```

#### Webhook é€šçŸ¥è¨­ç½®
```json
{
  "notifications": [
    {
      "channel": "webhook",
      "config": {
        "url": "https://your-webhook-endpoint.com/alerts",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer your-token"
        }
      }
    }
  ]
}
```

## ç³»çµ±ç›£æ§æŒ‡æ¨™

### 1. æ‡‰ç”¨ç¨‹å¼æŒ‡æ¨™

#### æ€§èƒ½æŒ‡æ¨™
```bash
# ç›£æ§è…³æœ¬
#!/bin/bash

# ç²å–æ‡‰ç”¨æ€§èƒ½æŒ‡æ¨™
get_app_metrics() {
    echo "=== æ‡‰ç”¨æ€§èƒ½æŒ‡æ¨™ $(date) ==="
    
    # API éŸ¿æ‡‰æ™‚é–“
    API_RESPONSE_TIME=$(curl -w "%{time_total}" -o /dev/null -s http://localhost:3000/api/v1/health)
    echo "API éŸ¿æ‡‰æ™‚é–“: ${API_RESPONSE_TIME}s"
    
    # æ´»èºç”¨æˆ¶æ•¸
    ACTIVE_USERS=$(curl -s http://localhost:3000/api/v1/metrics | jq -r '.active_users')
    echo "æ´»èºç”¨æˆ¶æ•¸: $ACTIVE_USERS"
    
    # éŒ¯èª¤ç‡
    ERROR_RATE=$(curl -s http://localhost:3000/api/v1/metrics | jq -r '.error_rate')
    echo "éŒ¯èª¤ç‡: $ERROR_RATE"
    
    # è¨˜æ†¶é«”ä½¿ç”¨
    MEMORY_USAGE=$(curl -s http://localhost:3000/api/v1/metrics | jq -r '.memory_usage')
    echo "è¨˜æ†¶é«”ä½¿ç”¨: $MEMORY_USAGE"
}

# åŸ·è¡Œç›£æ§
get_app_metrics
```

#### æ¥­å‹™æŒ‡æ¨™
```bash
# æ¥­å‹™æŒ‡æ¨™ç›£æ§
get_business_metrics() {
    echo "=== æ¥­å‹™æŒ‡æ¨™ $(date) ==="
    
    # ä»Šæ—¥æ£§æ¿å‰µå»ºæ•¸
    TODAY_PALLETS=$(psql $DATABASE_URL -t -c "SELECT COUNT(*) FROM record_palletinfo WHERE DATE(created_at) = CURRENT_DATE;")
    echo "ä»Šæ—¥æ–°å¢æ£§æ¿: $TODAY_PALLETS"
    
    # åº«å­˜è½‰ç§»æ¬¡æ•¸
    STOCK_TRANSFERS=$(psql $DATABASE_URL -t -c "SELECT COUNT(*) FROM record_transfer WHERE DATE(transfer_time) = CURRENT_DATE;")
    echo "ä»Šæ—¥åº«å­˜è½‰ç§»: $STOCK_TRANSFERS"
    
    # è¨‚å–®è™•ç†æ•¸
    ORDER_PROCESSED=$(psql $DATABASE_URL -t -c "SELECT COUNT(*) FROM record_aco WHERE DATE(created_date) = CURRENT_DATE;")
    echo "ä»Šæ—¥è¨‚å–®è™•ç†: $ORDER_PROCESSED"
}

# åŸ·è¡Œæ¥­å‹™æŒ‡æ¨™ç›£æ§
get_business_metrics
```

### 2. ç³»çµ±è³‡æºç›£æ§

#### ç³»çµ±è³‡æºè…³æœ¬
```bash
#!/bin/bash

# ç³»çµ±è³‡æºç›£æ§
system_resource_monitor() {
    echo "=== ç³»çµ±è³‡æºç›£æ§ $(date) ==="
    
    # CPU ä½¿ç”¨ç‡
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
    echo "CPU ä½¿ç”¨ç‡: $CPU_USAGE"
    
    # è¨˜æ†¶é«”ä½¿ç”¨ç‡
    MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')
    echo "è¨˜æ†¶é«”ä½¿ç”¨ç‡: $MEMORY_USAGE"
    
    # ç£ç¢Ÿä½¿ç”¨ç‡
    DISK_USAGE=$(df -h / | awk 'NR==2{print $5}')
    echo "ç£ç¢Ÿä½¿ç”¨ç‡: $DISK_USAGE"
    
    # ç¶²çµ¡é€£æ¥æ•¸
    NETWORK_CONNECTIONS=$(netstat -an | grep :3000 | wc -l)
    echo "ç¶²çµ¡é€£æ¥æ•¸: $NETWORK_CONNECTIONS"
    
    # è² è¼‰å¹³å‡
    LOAD_AVERAGE=$(uptime | awk -F'load average:' '{print $2}')
    echo "è² è¼‰å¹³å‡: $LOAD_AVERAGE"
}

# åŸ·è¡Œç³»çµ±è³‡æºç›£æ§
system_resource_monitor
```

#### æ•¸æ“šåº«ç›£æ§
```bash
# æ•¸æ“šåº«ç›£æ§è…³æœ¬
database_monitor() {
    echo "=== æ•¸æ“šåº«ç›£æ§ $(date) ==="
    
    # é€£æ¥æ•¸
    DB_CONNECTIONS=$(psql $DATABASE_URL -t -c "SELECT count(*) FROM pg_stat_activity;")
    echo "æ•¸æ“šåº«é€£æ¥æ•¸: $DB_CONNECTIONS"
    
    # æ•¸æ“šåº«å¤§å°
    DB_SIZE=$(psql $DATABASE_URL -t -c "SELECT pg_size_pretty(pg_database_size(current_database()));")
    echo "æ•¸æ“šåº«å¤§å°: $DB_SIZE"
    
    # æœ€æ…¢æŸ¥è©¢
    SLOW_QUERIES=$(psql $DATABASE_URL -t -c "SELECT count(*) FROM pg_stat_statements WHERE mean_exec_time > 1000;")
    echo "æ…¢æŸ¥è©¢æ•¸é‡: $SLOW_QUERIES"
    
    # é–ç­‰å¾…
    LOCK_WAITS=$(psql $DATABASE_URL -t -c "SELECT count(*) FROM pg_locks WHERE NOT granted;")
    echo "é–ç­‰å¾…æ•¸é‡: $LOCK_WAITS"
}

# åŸ·è¡Œæ•¸æ“šåº«ç›£æ§
database_monitor
```

## æ—¥å¸¸ç¶­è­·ç¨‹åº

### 1. æ¯æ—¥ç¶­è­·æª¢æŸ¥å–®

#### è‡ªå‹•åŒ–æ¯æ—¥æª¢æŸ¥
```bash
#!/bin/bash

# æ¯æ—¥ç¶­è­·æª¢æŸ¥è…³æœ¬
daily_maintenance() {
    echo "=== æ¯æ—¥ç¶­è­·æª¢æŸ¥ $(date) ==="
    
    # 1. æª¢æŸ¥æœå‹™ç‹€æ…‹
    echo "1. æª¢æŸ¥æœå‹™ç‹€æ…‹:"
    systemctl is-active newpennine-wms
    
    # 2. å¥åº·æª¢æŸ¥
    echo "2. å¥åº·æª¢æŸ¥:"
    HEALTH_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/api/v1/health)
    if [ "$HEALTH_STATUS" -eq 200 ]; then
        echo "âœ… å¥åº·æª¢æŸ¥é€šé"
    else
        echo "âŒ å¥åº·æª¢æŸ¥å¤±æ•—: $HEALTH_STATUS"
    fi
    
    # 3. ç£ç¢Ÿç©ºé–“æª¢æŸ¥
    echo "3. ç£ç¢Ÿç©ºé–“æª¢æŸ¥:"
    df -h | grep -E "(Filesystem|/$|/var|/tmp)"
    
    # 4. è¨˜æ†¶é«”ä½¿ç”¨æª¢æŸ¥
    echo "4. è¨˜æ†¶é«”ä½¿ç”¨æª¢æŸ¥:"
    free -h
    
    # 5. æ—¥èªŒæª¢æŸ¥
    echo "5. æ—¥èªŒæª¢æŸ¥:"
    ERROR_COUNT=$(grep -c "ERROR" /var/log/newpennine-wms/error.log 2>/dev/null || echo "0")
    echo "ä»Šæ—¥éŒ¯èª¤æ•¸: $ERROR_COUNT"
    
    # 6. å‚™ä»½æª¢æŸ¥
    echo "6. å‚™ä»½æª¢æŸ¥:"
    BACKUP_DATE=$(date +%Y-%m-%d)
    if [ -f "/var/backups/newpennine-wms/${BACKUP_DATE}_backup.sql" ]; then
        echo "âœ… ä»Šæ—¥å‚™ä»½å­˜åœ¨"
    else
        echo "âŒ ä»Šæ—¥å‚™ä»½ä¸å­˜åœ¨"
    fi
    
    # 7. å‘Šè­¦æª¢æŸ¥
    echo "7. å‘Šè­¦æª¢æŸ¥:"
    ACTIVE_ALERTS=$(curl -s http://localhost:3000/api/v1/alerts/active | jq length)
    echo "æ´»èºå‘Šè­¦æ•¸: $ACTIVE_ALERTS"
}

# åŸ·è¡Œæ¯æ—¥ç¶­è­·
daily_maintenance > /var/log/newpennine-wms/daily_maintenance_$(date +%Y%m%d).log 2>&1
```

### 2. é€±æœŸæ€§ç¶­è­·ä»»å‹™

#### æ¯é€±ç¶­è­·
```bash
#!/bin/bash

# æ¯é€±ç¶­è­·è…³æœ¬
weekly_maintenance() {
    echo "=== æ¯é€±ç¶­è­· $(date) ==="
    
    # 1. æ•¸æ“šåº«å„ªåŒ–
    echo "1. æ•¸æ“šåº«å„ªåŒ–:"
    psql $DATABASE_URL -c "VACUUM ANALYZE;"
    psql $DATABASE_URL -c "REINDEX DATABASE newpennine_wms;"
    
    # 2. æ¸…ç†èˆŠæ—¥èªŒ
    echo "2. æ¸…ç†èˆŠæ—¥èªŒ:"
    find /var/log/newpennine-wms -name "*.log" -mtime +7 -delete
    
    # 3. æ¸…ç†èˆŠå‚™ä»½
    echo "3. æ¸…ç†èˆŠå‚™ä»½:"
    find /var/backups/newpennine-wms -name "*.sql" -mtime +30 -delete
    
    # 4. æª¢æŸ¥è­‰æ›¸
    echo "4. æª¢æŸ¥ SSL è­‰æ›¸:"
    if command -v certbot &> /dev/null; then
        certbot certificates
    fi
    
    # 5. ç³»çµ±æ›´æ–°æª¢æŸ¥
    echo "5. ç³»çµ±æ›´æ–°æª¢æŸ¥:"
    apt list --upgradable
    
    # 6. æ€§èƒ½åˆ†æ
    echo "6. æ€§èƒ½åˆ†æ:"
    curl -s http://localhost:3000/api/v1/metrics > /tmp/weekly_metrics_$(date +%Y%m%d).json
    
    # 7. å‘Šè­¦æ­·å²åˆ†æ
    echo "7. å‘Šè­¦æ­·å²åˆ†æ:"
    curl -s http://localhost:3000/api/v1/alerts/history?days=7 | jq '.summary'
}

# åŸ·è¡Œæ¯é€±ç¶­è­·
weekly_maintenance > /var/log/newpennine-wms/weekly_maintenance_$(date +%Y%m%d).log 2>&1
```

#### æ¯æœˆç¶­è­·
```bash
#!/bin/bash

# æ¯æœˆç¶­è­·è…³æœ¬
monthly_maintenance() {
    echo "=== æ¯æœˆç¶­è­· $(date) ==="
    
    # 1. å®Œæ•´ç³»çµ±å‚™ä»½
    echo "1. å®Œæ•´ç³»çµ±å‚™ä»½:"
    tar -czf "/var/backups/newpennine-wms/monthly_backup_$(date +%Y%m).tar.gz" /var/www/newpennine-wms
    
    # 2. æ•¸æ“šåº«å®Œæ•´å‚™ä»½
    echo "2. æ•¸æ“šåº«å®Œæ•´å‚™ä»½:"
    pg_dump $DATABASE_URL > "/var/backups/newpennine-wms/monthly_db_backup_$(date +%Y%m).sql"
    
    # 3. æ€§èƒ½å ±å‘Šç”Ÿæˆ
    echo "3. æ€§èƒ½å ±å‘Šç”Ÿæˆ:"
    npm run test:perf:report
    
    # 4. å®‰å…¨å¯©è¨ˆ
    echo "4. å®‰å…¨å¯©è¨ˆ:"
    npm audit
    
    # 5. ä¾è³´æ›´æ–°æª¢æŸ¥
    echo "5. ä¾è³´æ›´æ–°æª¢æŸ¥:"
    npm outdated
    
    # 6. ç³»çµ±å¥åº·å ±å‘Š
    echo "6. ç³»çµ±å¥åº·å ±å‘Š:"
    curl -s http://localhost:3000/api/v2/health > "/var/reports/health_report_$(date +%Y%m).json"
}

# åŸ·è¡Œæ¯æœˆç¶­è­·
monthly_maintenance > /var/log/newpennine-wms/monthly_maintenance_$(date +%Y%m).log 2>&1
```

## ç›£æ§å„€è¡¨æ¿

### 1. è¨ªå•å‘Šè­¦å„€è¡¨æ¿

```bash
# è¨ªå•å‘Šè­¦ç®¡ç†ç•Œé¢
open http://localhost:3000/admin/alerts

# ä¸»è¦åŠŸèƒ½:
# - å‘Šè­¦è¦å‰‡ç®¡ç†
# - å‘Šè­¦æ­·å²æŸ¥çœ‹
# - é€šçŸ¥è¨­å®š
# - ç³»çµ±ç‹€æ…‹ç›£æ§
```

### 2. æ€§èƒ½ç›£æ§å„€è¡¨æ¿

```bash
# æ€§èƒ½ç›£æ§è…³æœ¬
performance_dashboard() {
    echo "=== æ€§èƒ½ç›£æ§å„€è¡¨æ¿ $(date) ==="
    
    # ç²å–æ‰€æœ‰æŒ‡æ¨™
    METRICS=$(curl -s http://localhost:3000/api/v1/metrics)
    
    # é¡¯ç¤ºé—œéµæŒ‡æ¨™
    echo "API éŸ¿æ‡‰æ™‚é–“: $(echo $METRICS | jq -r '.api_response_time.avg')"
    echo "éŒ¯èª¤ç‡: $(echo $METRICS | jq -r '.error_rate')"
    echo "æ´»èºç”¨æˆ¶: $(echo $METRICS | jq -r '.active_users')"
    echo "è¨˜æ†¶é«”ä½¿ç”¨: $(echo $METRICS | jq -r '.memory_usage')"
    echo "CPU ä½¿ç”¨: $(echo $METRICS | jq -r '.cpu_usage')"
    
    # ç”Ÿæˆç°¡å–®åœ–è¡¨
    echo "=== éå» 24 å°æ™‚è¶¨å‹¢ ==="
    # æ­¤è™•å¯ä»¥æ·»åŠ åœ–è¡¨ç”Ÿæˆé‚è¼¯
}

# åŸ·è¡Œæ€§èƒ½ç›£æ§
performance_dashboard
```

## è‡ªå‹•åŒ–ç›£æ§è…³æœ¬

### 1. æŒçºŒç›£æ§å®ˆè­·ç¨‹åº

```bash
#!/bin/bash

# æŒçºŒç›£æ§å®ˆè­·ç¨‹åº
monitoring_daemon() {
    echo "å•Ÿå‹•ç›£æ§å®ˆè­·ç¨‹åº $(date)"
    
    while true; do
        # å¥åº·æª¢æŸ¥
        HEALTH_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/api/v1/health)
        
        if [ "$HEALTH_STATUS" -ne 200 ]; then
            echo "$(date): å¥åº·æª¢æŸ¥å¤±æ•— - ç‹€æ…‹ç¢¼: $HEALTH_STATUS"
            
            # ç™¼é€å‘Šè­¦
            send_alert "å¥åº·æª¢æŸ¥å¤±æ•—" "HTTP ç‹€æ…‹ç¢¼: $HEALTH_STATUS"
            
            # å˜—è©¦é‡å•Ÿæœå‹™
            if [ "$HEALTH_STATUS" -eq 000 ]; then
                echo "$(date): å˜—è©¦é‡å•Ÿæœå‹™"
                systemctl restart newpennine-wms
            fi
        fi
        
        # æª¢æŸ¥è³‡æºä½¿ç”¨
        MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100.0}')
        DISK_USAGE=$(df -h / | awk 'NR==2{print $5}' | sed 's/%//')
        
        if [ "$MEMORY_USAGE" -gt 90 ]; then
            send_alert "è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜" "ç•¶å‰ä½¿ç”¨ç‡: ${MEMORY_USAGE}%"
        fi
        
        if [ "$DISK_USAGE" -gt 85 ]; then
            send_alert "ç£ç¢Ÿä½¿ç”¨ç‡éé«˜" "ç•¶å‰ä½¿ç”¨ç‡: ${DISK_USAGE}%"
        fi
        
        sleep 30
    done
}

# ç™¼é€å‘Šè­¦å‡½æ•¸
send_alert() {
    local subject="$1"
    local message="$2"
    
    # Slack é€šçŸ¥
    curl -X POST -H 'Content-type: application/json' \
        --data "{\"text\":\"ğŸš¨ NewPennine WMS å‘Šè­¦: $subject - $message\"}" \
        $SLACK_WEBHOOK_URL
    
    # é›»éƒµé€šçŸ¥
    echo "$message" | mail -s "NewPennine WMS å‘Šè­¦: $subject" ops@newpennine.com
}

# å•Ÿå‹•å®ˆè­·ç¨‹åº
monitoring_daemon &
```

### 2. è‡ªå‹•æ¢å¾©è…³æœ¬

```bash
#!/bin/bash

# è‡ªå‹•æ¢å¾©è…³æœ¬
auto_recovery() {
    echo "å•Ÿå‹•è‡ªå‹•æ¢å¾©ç³»çµ± $(date)"
    
    # æª¢æŸ¥æœå‹™ç‹€æ…‹
    if ! systemctl is-active --quiet newpennine-wms; then
        echo "$(date): æœå‹™æœªé‹è¡Œï¼Œå˜—è©¦å•Ÿå‹•"
        systemctl start newpennine-wms
        
        # ç­‰å¾…æœå‹™å•Ÿå‹•
        sleep 30
        
        # é©—è­‰å•Ÿå‹•
        if curl -s http://localhost:3000/api/v1/health | grep -q "healthy"; then
            echo "$(date): æœå‹™æ¢å¾©æˆåŠŸ"
            send_alert "æœå‹™æ¢å¾©" "æœå‹™å·²æˆåŠŸé‡å•Ÿ"
        else
            echo "$(date): æœå‹™æ¢å¾©å¤±æ•—"
            send_alert "æœå‹™æ¢å¾©å¤±æ•—" "éœ€è¦æ‰‹å‹•å¹²é "
        fi
    fi
    
    # æª¢æŸ¥æ•¸æ“šåº«é€£æ¥
    if ! psql $DATABASE_URL -c "SELECT 1;" > /dev/null 2>&1; then
        echo "$(date): æ•¸æ“šåº«é€£æ¥å¤±æ•—ï¼Œå˜—è©¦é‡é€£"
        systemctl restart postgresql
        sleep 30
        
        if psql $DATABASE_URL -c "SELECT 1;" > /dev/null 2>&1; then
            echo "$(date): æ•¸æ“šåº«é€£æ¥æ¢å¾©"
            send_alert "æ•¸æ“šåº«æ¢å¾©" "æ•¸æ“šåº«é€£æ¥å·²æ¢å¾©"
        else
            echo "$(date): æ•¸æ“šåº«é€£æ¥æ¢å¾©å¤±æ•—"
            send_alert "æ•¸æ“šåº«æ¢å¾©å¤±æ•—" "éœ€è¦æ‰‹å‹•å¹²é "
        fi
    fi
}

# åŸ·è¡Œè‡ªå‹•æ¢å¾©
auto_recovery
```

## å‘Šè­¦å‡ç´šç¨‹åº

### 1. å‘Šè­¦ç´šåˆ¥å®šç¾©

```
Info (è³‡è¨Š)      â†’ è¨˜éŒ„äº‹ä»¶ï¼Œç„¡éœ€ç«‹å³è¡Œå‹•
Warning (è­¦å‘Š)   â†’ éœ€è¦é—œæ³¨ï¼Œå¯èƒ½å½±éŸ¿æ€§èƒ½
Error (éŒ¯èª¤)     â†’ éœ€è¦ç«‹å³è¡Œå‹•ï¼Œå½±éŸ¿åŠŸèƒ½
Critical (é—œéµ)  â†’ ç·Šæ€¥æƒ…æ³ï¼Œå¯èƒ½å°è‡´æœå‹™ä¸­æ–·
```

### 2. å‡ç´šæµç¨‹

```bash
# å‘Šè­¦å‡ç´šè…³æœ¬
alert_escalation() {
    local alert_level="$1"
    local alert_message="$2"
    
    case $alert_level in
        "info")
            # è¨˜éŒ„åˆ°æ—¥èªŒ
            echo "$(date): INFO - $alert_message" >> /var/log/newpennine-wms/alerts.log
            ;;
        "warning")
            # ç™¼é€åˆ°ç›£æ§é »é“
            send_slack_alert "#newpennine-monitoring" "âš ï¸ WARNING: $alert_message"
            ;;
        "error")
            # ç™¼é€åˆ°é‹ç¶­é »é“
            send_slack_alert "#newpennine-ops" "âŒ ERROR: $alert_message"
            send_email_alert "ops@newpennine.com" "NewPennine WMS Error" "$alert_message"
            ;;
        "critical")
            # ç™¼é€åˆ°ç·Šæ€¥é »é“
            send_slack_alert "#newpennine-emergency" "ğŸš¨ CRITICAL: $alert_message"
            send_email_alert "emergency@newpennine.com" "NewPennine WMS CRITICAL" "$alert_message"
            send_sms_alert "+852-1234-5678" "NewPennine WMS CRITICAL: $alert_message"
            ;;
    esac
}
```

## ç¶­è­·è¨ˆåŠƒæ¨¡æ¿

### 1. æœˆåº¦ç¶­è­·è¨ˆåŠƒ

```markdown
# NewPennine WMS æœˆåº¦ç¶­è­·è¨ˆåŠƒ

## ç¬¬ä¸€é€±
- [ ] ç³»çµ±æ€§èƒ½å ±å‘Šå¯©æŸ¥
- [ ] æ•¸æ“šåº«å„ªåŒ–å’Œæ¸…ç†
- [ ] å®‰å…¨è£œä¸å®‰è£
- [ ] å‚™ä»½é©—è­‰

## ç¬¬äºŒé€±
- [ ] ç›£æ§å‘Šè­¦è¦å‰‡å¯©æŸ¥
- [ ] æ—¥èªŒåˆ†æå’Œæ¸…ç†
- [ ] ä¾è³´æ›´æ–°æª¢æŸ¥
- [ ] æ€§èƒ½æ¸¬è©¦åŸ·è¡Œ

## ç¬¬ä¸‰é€±
- [ ] ç½é›£æ¢å¾©æ¸¬è©¦
- [ ] æ–‡æª”æ›´æ–°
- [ ] åŸ¹è¨“ææ–™æ›´æ–°
- [ ] å®¹é‡è¦åŠƒå¯©æŸ¥

## ç¬¬å››é€±
- [ ] æœˆåº¦å ±å‘Šæº–å‚™
- [ ] ç³»çµ±å¥åº·è©•ä¼°
- [ ] ä¸‹æœˆè¨ˆåŠƒåˆ¶å®š
- [ ] åœ˜éšŠå›é¡§æœƒè­°
```

### 2. å¹´åº¦ç¶­è­·è¨ˆåŠƒ

```markdown
# NewPennine WMS å¹´åº¦ç¶­è­·è¨ˆåŠƒ

## Q1 (1-3æœˆ)
- [ ] ç³»çµ±æ¶æ§‹å¯©æŸ¥
- [ ] æ€§èƒ½åŸºæº–æ¸¬è©¦
- [ ] å®‰å…¨å¯©è¨ˆ
- [ ] å‚™ä»½ç­–ç•¥è©•ä¼°

## Q2 (4-6æœˆ)
- [ ] æŠ€è¡“å‚µå‹™æ¸…ç†
- [ ] ç›£æ§ç³»çµ±å‡ç´š
- [ ] åŸ¹è¨“è¨ˆåŠƒæ›´æ–°
- [ ] ç½é›£æ¢å¾©æ¼”ç·´

## Q3 (7-9æœˆ)
- [ ] ç³»çµ±æ“´å±•è©•ä¼°
- [ ] æ–°åŠŸèƒ½è¦åŠƒ
- [ ] å·¥å…·éˆå‡ç´š
- [ ] æµç¨‹å„ªåŒ–

## Q4 (10-12æœˆ)
- [ ] å¹´åº¦ç¸½çµå ±å‘Š
- [ ] é ç®—è¨ˆåŠƒåˆ¶å®š
- [ ] æŠ€è¡“è·¯ç·šåœ–æ›´æ–°
- [ ] ç¯€å‡æ—¥å€¼ç­å®‰æ’
```

## è¯çµ¡å’Œæ”¯æ´

### ç›£æ§æ”¯æ´è¯çµ¡
- **ç›£æ§åœ˜éšŠ**: monitoring@newpennine.com
- **å‘Šè­¦ç®¡ç†**: alerts@newpennine.com
- **æ€§èƒ½å„ªåŒ–**: performance@newpennine.com
- **ç·Šæ€¥æ”¯æ´**: +852-1234-5678

### ç¶­è­·æ”¯æ´è¯çµ¡
- **æ—¥å¸¸ç¶­è­·**: maintenance@newpennine.com
- **è¨ˆåŠƒç¶­è­·**: planned-maintenance@newpennine.com
- **ç·Šæ€¥ç¶­è­·**: emergency@newpennine.com

---

**ç‰ˆæœ¬**: v2.0.7  
**å»ºç«‹æ—¥æœŸ**: 2025-07-17  
**æœ€å¾Œæ›´æ–°**: 2025-07-17  
**ä¸‹æ¬¡å¯©æŸ¥**: 2025-10-17  

**ç¶­è­·è€…**: NewPennine DevOps & Performance Team  
**æ–‡æª”è·¯å¾‘**: `/docs/manual/monitoring-maintenance-guide.md`