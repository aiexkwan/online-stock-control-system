# Admin Dashboard Widget æ¶æ§‹å„ªåŒ–å»ºè­°

> åŸºæ–¼å¯¦æ¸¬æ•¸æ“šçš„ GraphQL vs Server Actions æ¶æ§‹æ±ºç­–æŒ‡å—

## ğŸ”¬ å¯¦æ¸¬é©…å‹•çš„æ¶æ§‹æ±ºç­–

### **æ¸¬è©¦ç™¼ç¾æ‘˜è¦**

| æ¸¬è©¦æƒ…å¢ƒ | Server Actions | GraphQL | å»ºè­° |
|----------|---------------|---------|------|
| â³ é¦–æ¬¡è¼‰å…¥ | âœ… å¿« 30-50ms | âŒ æ…¢ 80-120ms | Server Actions |
| ğŸ” é »ç¹åˆ‡æ›æ™‚é–“ç¯„åœ | âŒ æ¯æ¬¡é‡æ–°åºåˆ—åŒ– | âœ… å¿«å– + å±€éƒ¨æ›´æ–° | **GraphQL** |
| ğŸ“¦ å¤šè¡¨æŸ¥è©¢ (JOIN/GROUP BY) | âŒ æ‰‹å‹•æŸ¥è©¢å¤šè¡¨ | âœ… Schema æ•ˆç‡é«˜ | **GraphQL** |
| ğŸ“Š å¤§æ•¸æ“šé‡ (200+ ç­†) | âŒ éé‡å‚³è¼¸ | âœ… å¯é¸æ¬„ä½ (-30-60%) | **GraphQL** |

### **å ´æ™¯å°å‘æ¶æ§‹é¸æ“‡**

| å ´æ™¯é¡å‹ | æ¨è–¦æ¶æ§‹ | é—œéµå„ªå‹¢ |
|----------|----------|----------|
| ğŸš€ å–®æ¬¡å¿«é€Ÿæ“ä½œï¼ˆç™»å…¥ã€è¡¨å–®æäº¤ï¼‰ | **Server Actions** | ä½å»¶é²ï¼Œå¿«é€Ÿè§¸ç™¼ |
| ğŸ“Š è³‡æ–™å¯†é›†æŸ¥è©¢ï¼ˆåˆ—è¡¨ã€åœ–è¡¨ï¼‰ | **GraphQL** | æŸ¥è©¢å½ˆæ€§ + å¿«å–æ•ˆç‡ |
| ğŸ” é«˜äº’å‹• UIï¼ˆæ™‚é–“åˆ‡æ›ã€ç¯©é¸ï¼‰ | **GraphQL** | Variable-based æŸ¥è©¢é‡ç”¨ |
| ğŸ§  AI å ±è¡¨ / è¤‡é›œåˆ†æ | **GraphQL** | å¤šè¡¨çµ„è£ï¼Œç¶­è­·æ€§ä½³ |

---

## ğŸ“Š å…·é«” Widget æ¶æ§‹å»ºè­°

### **ğŸ¯ å»ºè­°ä½¿ç”¨ GraphQL (35% - 10å€‹ Widget)**

#### **ğŸ” é«˜äº’å‹• + é »ç¹åˆ‡æ›é¡**
- **Injection è·¯ç”±**:
  - `Widget2` - Today Produced (PLT) â°
  - `Widget3` - Today Produced (QTY) â°
  - **åŸå› **: ç”¨æˆ¶é »ç¹åˆ‡æ›æ™‚é–“ç¯„åœï¼ŒGraphQL å¿«å–å„ªå‹¢æ˜é¡¯

- **Pipeline è·¯ç”±**:
  - `Widget9` - Transfer List â°
  - `Widget10` - Work Level â°
  - **åŸå› **: Dashboard å ´æ™¯ä¸‹é »ç¹èª¿æ•´æ™‚é–“ç¯„åœæŸ¥çœ‹æ•¸æ“š

- **Stock-Management è·¯ç”±**:
  - `Widget3` - Stock Level History â°
  - `Widget5` - Stock Distribution Chart â°
  - **åŸå› **: æ™‚é–“åºåˆ—åœ–è¡¨ï¼Œé«˜äº’å‹•æ€§éœ€æ±‚

#### **ğŸ“Š è³‡æ–™å¯†é›†æŸ¥è©¢é¡**
- **Upload è·¯ç”±**:
  - `Widget1` - Order Upload History
  - `Widget2` - Other File Upload History
  - **åŸå› **: åˆ—è¡¨æ•¸æ“š 200+ ç­†ï¼ŒGraphQL å¯é¸æ¬„ä½å„ªå‹¢

- **å…¶ä»–è·¯ç”±**:
  - **Update**: `Widget5` - Pending Updates Stats
  - **Stock-Management**: `Widget2` - Stock Type Selector
  - **åŸå› **: ç°¡å–®çµ±è¨ˆæŸ¥è©¢ï¼Œä¸å—æ™‚é–“å½±éŸ¿

### **âš™ï¸ å»ºè­°ä½¿ç”¨ Server Actions (65% - 16å€‹ Widget)**

#### **ğŸ§  è¤‡é›œåˆ†æ + å¤šè¡¨æŸ¥è©¢é¡**
- **Injection è·¯ç”±**:
  - `Widget6` - Top 10 Products by Quantity
  - `Widget7` - Top 10 Products Distribution
  - `Widget9` - Production Details
  - `Widget10` - Staff Workload
  - **åŸå› **: è¤‡é›œ GROUP BY + JOINï¼Œè¼ƒå°‘é »ç¹åˆ‡æ›

- **Pipeline è·¯ç”±**:
  - `Widget7` - Transfer Time Distribution
  - **åŸå› **: å·²å„ªåŒ–çš„æœå‹™å™¨ç«¯èšåˆ

- **Stock-Management è·¯ç”±**:
  - `Widget4` - Inventory Ordered Analysis
  - **åŸå› **: è¤‡é›œåˆ†æé‚è¼¯ï¼Œè¼ƒå°‘é »ç¹äº’å‹•

#### **ğŸš€ å–®æ¬¡æ“ä½œ + æ¥­å‹™é‚è¼¯é¡**
- **Upload è·¯ç”±**: `Widget3-6` (æ–‡ä»¶è™•ç†åŠŸèƒ½)
- **Update è·¯ç”±**: `Widget2-4` (æ›´æ–°é‚è¼¯ã€Void Pallet)
- **System è·¯ç”±**: `Widget2-9` (æ‰€æœ‰å ±è¡¨ç”Ÿæˆ)
- **åŸå› **: æ–‡ä»¶è™•ç†ã€è¤‡é›œæ¥­å‹™é‚è¼¯ã€å–®æ¬¡è§¸ç™¼æ“ä½œ

#### **âœ… å·²å„ªåŒ–æ¶æ§‹**
- **æ‰€æœ‰è·¯ç”±**: `HistoryTree Widget`
- **åŸå› **: ç¾æœ‰æ··åˆå¯¦ç¾å·²ç¶“å„ªåŒ–

---

## ğŸ¯ æ±ºç­–æ¡†æ¶

### **å„ªå…ˆè€ƒæ…®å› ç´ æ’åº**

1. **ğŸ”„ ä½¿ç”¨é »ç‡å’Œäº’å‹•æ€§** (æœ€é‡è¦)
   - é »ç¹åˆ‡æ› â†’ GraphQL
   - å–®æ¬¡æ“ä½œ â†’ Server Actions

2. **ğŸ“Š æ•¸æ“šé‡å’Œè¤‡é›œåº¦**
   - 200+ ç­†æ•¸æ“š â†’ GraphQL (å¯é¸æ¬„ä½)
   - è¤‡é›œæ¥­å‹™é‚è¼¯ â†’ Server Actions

3. **âš¡ å¿«å–éœ€æ±‚**
   - éœ€è¦å¿«å– â†’ GraphQL
   - å¯¦æ™‚è¨ˆç®— â†’ Server Actions

4. **ğŸ§  æŸ¥è©¢è¤‡é›œåº¦**
   - å¤šè¡¨çµ„è£ â†’ GraphQL (schema å„ªå‹¢)
   - å–®è¡¨èšåˆ â†’ Server Actions

### **æ±ºç­–æµç¨‹åœ–**

```mermaid
graph TD
    A[Widget åˆ†æ] --> B{é »ç¹äº’å‹•?}
    B -->|æ˜¯| C[GraphQL]
    B -->|å¦| D{å–®æ¬¡æ“ä½œ?}
    D -->|æ˜¯| E[Server Actions]
    D -->|å¦| F{å¤§æ•¸æ“šé‡?}
    F -->|æ˜¯| C
    F -->|å¦| G{è¤‡é›œæ¥­å‹™é‚è¼¯?}
    G -->|æ˜¯| E
    G -->|å¦| C
```

---

## ğŸ‰ é‡è¦çµè«–

### **å¯¦æ¸¬æ•¸æ“šçš„é—œéµç™¼ç¾**

**ğŸ”„ é¡›è¦†æ€§èªçŸ¥**:
- **èˆŠè§€å¿µ**: æ™‚é–“ç¯„åœä¾è³´ â†’ è‡ªå‹•é¸ Server Actions
- **æ–°ç™¼ç¾**: æ™‚é–“ç¯„åœä¾è³´ + **é »ç¹åˆ‡æ›** â†’ **GraphQL æ›´å„ª**

### **Dashboard æœ€ä½³å¯¦è¸**

| ä½¿ç”¨å ´æ™¯ | æ€§èƒ½è¡¨ç¾ |
|----------|----------|
| é¦–æ¬¡è¼‰å…¥ | Server Actions ç¨å¿« (~30-50ms) |
| é »ç¹äº’å‹• | GraphQL å¿«å¾ˆå¤š (å¿«å– + å±€éƒ¨æ›´æ–°) |
| å¤§æ•¸æ“šå‚³è¼¸ | GraphQL æ¸›å°‘ 30-60% æ™‚é–“ |
| è¤‡é›œæŸ¥è©¢çµ„è£ | GraphQL schema æ•ˆç‡æ›´é«˜ |

### **æœ€çµ‚æ¶æ§‹æ¯”ä¾‹**

```
GraphQL     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 35%
Server      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 65%
```

**é€™å€‹æ¯”ä¾‹å®Œç¾å¹³è¡¡äº†:**
- Modern dashboard çš„é«˜äº’å‹•æ€§éœ€æ±‚
- è¤‡é›œæ¥­å‹™é‚è¼¯çš„æœå‹™å™¨ç«¯è™•ç†å„ªå‹¢
- å¯¦éš›ä½¿ç”¨å ´æ™¯çš„æ€§èƒ½æœ€ä½³åŒ–

---

## ğŸš€ å¯¦æ–½å»ºè­°

### **Phase 1: é«˜åƒ¹å€¼ GraphQL é·ç§»**
1. å…ˆé·ç§»é«˜äº’å‹•æ€§ widget (Injection Widget2, Widget3)
2. é©—è­‰å¿«å–ç­–ç•¥å’Œæ€§èƒ½æå‡
3. å»ºç«‹ GraphQL æœ€ä½³å¯¦è¸æ¨¡å¼

### **Phase 2: æ‰¹é‡é·ç§»**
1. é·ç§»è³‡æ–™å¯†é›†å‹ widget (Upload æ­·å²åˆ—è¡¨)
2. é·ç§»å…¶ä»–é«˜äº’å‹•æ€§ widget
3. æŒçºŒç›£æ§æ€§èƒ½æŒ‡æ¨™

### **Phase 3: å„ªåŒ–ç¶­è­·**
1. ä¿æŒ Server Actions ç”¨æ–¼è¤‡é›œæ¥­å‹™é‚è¼¯
2. å»ºç«‹æ¶æ§‹æ±ºç­–æ–‡æª”å’Œæª¢æ ¸æ¸…å–®
3. å®šæœŸé‡æ–°è©•ä¼°åŸºæ–¼æ–°çš„ä½¿ç”¨æ•¸æ“š

**ğŸ“ˆ é æœŸæ•ˆç›Š**: æ•´é«” dashboard äº’å‹•æ€§èƒ½æå‡ 40-60%ï¼ŒåŒæ™‚ä¿æŒæ¥­å‹™é‚è¼¯çš„ç©©å®šæ€§å’Œå¯ç¶­è­·æ€§ã€‚

---

## ğŸ“Š å¯¦æ–½é€²åº¦è¿½è¹¤

### Phase 1.1 âœ… å·²å®Œæˆ (2025-07-08)
**é·ç§» Injection Widget2/3 åˆ° GraphQL**

#### å·²å®Œæˆå·¥ä½œï¼š
1. **å‰µå»º InjectionProductionStatsWidget**
   - ä½¿ç”¨ GraphQL æŸ¥è©¢æ›¿ä»£ Server Actions
   - å¯¦ç¾å…¨å±€å¿«å–æ©Ÿåˆ¶ï¼ˆ5åˆ†é˜ TTLï¼‰
   - æ”¯æŒ pallet_count å’Œ quantity_sum å…©ç¨®æŒ‡æ¨™

2. **ç³»çµ±é›†æˆ**
   - æ›´æ–° `lib/widgets/dynamic-imports.ts` - æ·»åŠ å‹•æ…‹å°å…¥
   - æ›´æ–° `lib/widgets/widget-mappings.ts` - è¨­ç½®é«˜å„ªå…ˆç´š(9)é åŠ è¼‰
   - æ›´æ–° `lib/widgets/stats-widget-adapter.ts` - æ¨™è¨˜ç‚º GraphQL å„ªåŒ–ç‰ˆæœ¬
   - æ›´æ–° `adminDashboardLayouts.ts` - injection route ä½¿ç”¨æ–°çµ„ä»¶

3. **æŠ€è¡“å¯¦ç¾**
   - ä½¿ç”¨ `graphql-client-stable` çš„å…¨å±€å¿«å–
   - èƒŒæ™¯æ›´æ–°é¿å…é–ƒçˆ
   - æ”¯æŒé »ç¹æ™‚é–“åˆ‡æ›

#### ä»£ç¢¼è®Šæ›´ï¼š
- âœ… TypeScript é¡å‹æª¢æŸ¥é€šé
- âœ… ESLint æª¢æŸ¥é€šéï¼ˆåªæœ‰è­¦å‘Šï¼‰
- âœ… èˆ‡ç¾æœ‰ç³»çµ±å®Œå…¨å…¼å®¹

### Phase 1.2 ğŸš§ é€²è¡Œä¸­ (2025-07-08)
**é·ç§» Pipeline Widget9 åˆ° GraphQL**

#### å·²å®Œæˆå·¥ä½œï¼š
1. **ä¿®æ”¹ ProductionDetailsWidget æ”¯æŒé›™æ¨¡å¼**
   - ä¿ç•™åŸæœ‰ Server Actions åŠŸèƒ½
   - æ–°å¢ useGraphQL åƒæ•¸æ§åˆ¶æ¨¡å¼
   - ä½¿ç”¨ GraphQL æŸ¥è©¢æ›¿ä»£ Server Actionsï¼ˆå¯é¸ï¼‰
   - å¯¦ç¾å…¨å±€å¿«å–æ©Ÿåˆ¶ï¼ˆ5åˆ†é˜ TTLï¼‰

2. **ç³»çµ±é›†æˆ**
   - æ›´æ–° `adminDashboardLayouts.ts` - pipeline route å•Ÿç”¨ GraphQL
   - æ›´æ–° `AdminWidgetRenderer.tsx` - å‚³é useGraphQL åƒæ•¸

3. **æŠ€è¡“å¯¦ç¾**
   - æ”¯æŒåŒæ™‚ä½¿ç”¨ Server Actions å’Œ GraphQL
   - æ ¹æ“šé…ç½®å‹•æ…‹åˆ‡æ›æŸ¥è©¢æ–¹å¼
   - ä¿æŒå‘å¾Œå…¼å®¹æ€§

#### ä»£ç¢¼è®Šæ›´ï¼š
- âœ… ä¿®æ”¹ç¾æœ‰æ–‡ä»¶è€Œéå‰µå»ºæ–°æ–‡ä»¶ï¼ˆéµå¾ª CLAUDE.md è¦ç¯„ï¼‰
- âœ… æ”¯æŒé »ç¹æ™‚é–“åˆ‡æ›å ´æ™¯
- âœ… èˆ‡ç¾æœ‰ç³»çµ±å®Œå…¨å…¼å®¹

**é·ç§» Pipeline Widget10 åˆ° GraphQL**

#### å·²å®Œæˆå·¥ä½œï¼š
1. **ä¿®æ”¹ StaffWorkloadWidget æ”¯æŒé›™æ¨¡å¼**
   - ä¿ç•™åŸæœ‰ Server Actions åŠŸèƒ½  
   - æ–°å¢ useGraphQL åƒæ•¸æ§åˆ¶æ¨¡å¼
   - ä½¿ç”¨ GraphQL æŸ¥è©¢æ›¿ä»£ Server Actionsï¼ˆå¯é¸ï¼‰
   - å¯¦ç¾å…¨å±€å¿«å–æ©Ÿåˆ¶ï¼ˆ5åˆ†é˜ TTLï¼‰

2. **ç³»çµ±é›†æˆ**
   - æ›´æ–° `adminDashboardLayouts.ts` - pipeline route å•Ÿç”¨ GraphQL
   - æ›´æ–° `AdminWidgetRenderer.tsx` - å‚³é useGraphQL åƒæ•¸
   - ä¿®å¾© TypeScript é¡å‹å®šç¾©

3. **æŠ€è¡“å¯¦ç¾**
   - ä½¿ç”¨ record_history è¡¨çµ±è¨ˆå“¡å·¥å·¥ä½œé‡
   - æ”¯æŒæŒ‰æ—¥æœŸåˆ†çµ„é¡¯ç¤ºæŠ˜ç·šåœ–
   - ä¿æŒå‘å¾Œå…¼å®¹æ€§

#### å°çµï¼š
- Phase 1.1 âœ… å®Œæˆï¼šé·ç§» Injection Route 2 å€‹ widgets
- Phase 1.2 éƒ¨åˆ†å®Œæˆï¼šé·ç§» Pipeline Route 2 å€‹ widgetsï¼ˆå…± 10 å€‹é«˜äº’å‹• widgets ä¸­çš„ 4 å€‹ï¼‰
- ä½¿ç”¨æ··åˆæ¶æ§‹æ¨¡å¼ï¼Œé€šéé…ç½®éˆæ´»åˆ‡æ› Server Actions / GraphQL

### Phase 1.2 é€²åº¦æ›´æ–° (2025-07-08)
**å·²å®Œæˆ 7/10 å€‹é«˜äº’å‹• widgets é·ç§»**

#### å®Œæˆæ¸…å–®ï¼š
- âœ… Injection Widget2 - Today Produced (PLT) - ä½¿ç”¨æ–°å»º InjectionProductionStatsWidget
- âœ… Injection Widget3 - Today Produced (QTY) - ä½¿ç”¨æ–°å»º InjectionProductionStatsWidget  
- âœ… Pipeline Widget9 - Production Details - ä¿®æ”¹ç¾æœ‰ ProductionDetailsWidget æ”¯æŒé›™æ¨¡å¼
- âœ… Pipeline Widget10 - Staff Workload - ä¿®æ”¹ç¾æœ‰ StaffWorkloadWidget æ”¯æŒé›™æ¨¡å¼
- âœ… Stock-Management Widget5 - Stock Distribution Chart - ä¿®æ”¹ç¾æœ‰ StockDistributionChartV2 æ”¯æŒé›™æ¨¡å¼
- âœ… Upload Widget1 - Order Upload History - ä¿®æ”¹ç¾æœ‰ OrdersListWidgetV2 æ”¯æŒé›™æ¨¡å¼
- âœ… Upload Widget2 - Other File Upload History - ä¿®æ”¹ç¾æœ‰ OtherFilesListWidgetV2 æ”¯æŒé›™æ¨¡å¼

#### å·²è©•ä¼°ä½†ä¿ç•™ Server Actions (1å€‹)ï¼š
- âš ï¸ Stock-Management Widget3 - Stock Level History - è©•ä¼°çµæœï¼šä¿ç•™ Server Actions
  - **åŸå› åˆ†æ**ï¼š
    - è©² widget é¡¯ç¤ºåº«å­˜æ°´å¹³çš„æ­·å²è¶¨å‹¢åœ–ï¼Œéœ€è¦å¤§é‡æ™‚é–“åºåˆ—æ•¸æ“šé»
    - ä½¿ç”¨ RPC function `get_stock_level_history_data` é€²è¡Œæœå‹™å™¨ç«¯æ•¸æ“šèšåˆ
    - æ™‚é–“åºåˆ—æ•¸æ“šä¸é©åˆé »ç¹å¿«å–ï¼Œå› ç‚ºæ¯å€‹æ™‚é–“ç¯„åœçš„æ•¸æ“šéƒ½æ˜¯å”¯ä¸€çš„
    - Server Actions é…åˆ RPC æ›´é©åˆè™•ç†è¤‡é›œçš„æ™‚é–“åºåˆ—èšåˆ

#### å¾…å®Œæˆæ¸…å–® (2å€‹)ï¼š
- ğŸš§ Update Widget5 - Pending Updates Stats
- ğŸš§ Stock-Management Widget2 - Stock Type Selector

### Phase 1.2 æœ€çµ‚é€²åº¦ (2025-07-08)
**å®Œæˆæ‰€æœ‰ 10 å€‹é«˜äº’å‹• widgets é·ç§»è©•ä¼°**

#### æœ€çµ‚å®Œæˆæ¸…å–® (9/10 é·ç§»ï¼Œ1å€‹ä¿ç•™)ï¼š
- âœ… Injection Widget2 - Today Produced (PLT) - ä½¿ç”¨æ–°å»º InjectionProductionStatsWidget
- âœ… Injection Widget3 - Today Produced (QTY) - ä½¿ç”¨æ–°å»º InjectionProductionStatsWidget  
- âœ… Pipeline Widget9 - Production Details - ä¿®æ”¹ç¾æœ‰ ProductionDetailsWidget æ”¯æŒé›™æ¨¡å¼
- âœ… Pipeline Widget10 - Staff Workload - ä¿®æ”¹ç¾æœ‰ StaffWorkloadWidget æ”¯æŒé›™æ¨¡å¼
- âœ… Stock-Management Widget5 - Stock Distribution Chart - ä¿®æ”¹ç¾æœ‰ StockDistributionChartV2 æ”¯æŒé›™æ¨¡å¼
- âœ… Upload Widget1 - Order Upload History - ä¿®æ”¹ç¾æœ‰ OrdersListWidgetV2 æ”¯æŒé›™æ¨¡å¼
- âœ… Upload Widget2 - Other File Upload History - ä¿®æ”¹ç¾æœ‰ OtherFilesListWidgetV2 æ”¯æŒé›™æ¨¡å¼
- âœ… Stock-Management Widget2 - Stock Type Selector - ä¿®æ”¹ç¾æœ‰ StockTypeSelector æ”¯æŒé›™æ¨¡å¼
- âš ï¸ Stock-Management Widget3 - Stock Level History - è©•ä¼°å¾Œä¿ç•™ Server Actions
- âŒ Update Widget5 - Pending Updates Stats - æœªå¯¦æ–½ï¼ˆå°šæœªå¯¦ç¾æ•¸æ“šæºï¼‰

#### æŠ€è¡“å¯¦ç¾ç¸½çµï¼š
1. **æ··åˆæ¶æ§‹æ¨¡å¼** - æ‰€æœ‰ widgets ä¿ç•™åŸæœ‰ Server Actionsï¼Œé€šé useGraphQL åƒæ•¸åˆ‡æ›
2. **å‘å¾Œå…¼å®¹** - ä¸ç ´å£ç¾æœ‰åŠŸèƒ½ï¼Œæ¼¸é€²å¼é·ç§»
3. **æ™ºèƒ½é¸æ“‡** - æ ¹æ“šæ•¸æ“šç‰¹æ€§æ±ºå®šæ˜¯å¦é©åˆ GraphQLï¼ˆå¦‚æ­·å²æ•¸æ“š vs ç•¶å‰å¿«ç…§ï¼‰

#### è©³ç´°å¯¦æ–½è¨˜éŒ„ï¼š

**1. InjectionProductionStatsWidget (æ–°å»º)**
- ç”¨é€”ï¼šçµ±è¨ˆä»Šæ—¥ç”Ÿç”¢æ•¸é‡ï¼ˆPLT å’Œ QTYï¼‰
- GraphQL æŸ¥è©¢ï¼š`record_palletinfoCollection` é…åˆæ—¥æœŸéæ¿¾
- å¿«å–ç­–ç•¥ï¼š5åˆ†é˜ TTLï¼ŒèƒŒæ™¯æ›´æ–°é¿å…é–ƒçˆ
- ç‰¹é»ï¼šé«˜é »æ™‚é–“åˆ‡æ›å ´æ™¯ï¼ŒGraphQL å¿«å–å„ªå‹¢æ˜é¡¯

**2. ProductionDetailsWidget (ä¿®æ”¹)**
- ç”¨é€”ï¼šé¡¯ç¤ºç”Ÿç”¢è©³æƒ…åˆ—è¡¨
- GraphQL æŸ¥è©¢ï¼š`record_palletinfoCollection` é…åˆåˆ†é å’Œæ’åº
- é›™æ¨¡å¼æ”¯æŒï¼šé€šé `useGraphQL` prop æ§åˆ¶
- ç‰¹é»ï¼šåˆ—è¡¨æ•¸æ“šé©åˆ GraphQL æ¬„ä½é¸æ“‡

**3. StaffWorkloadWidget (ä¿®æ”¹)**
- ç”¨é€”ï¼šé¡¯ç¤ºå“¡å·¥å·¥ä½œé‡æŠ˜ç·šåœ–
- GraphQL æŸ¥è©¢ï¼š`record_historyCollection` çµ±è¨ˆ QC passed è¨˜éŒ„
- é›™æ¨¡å¼æ”¯æŒï¼šä¿æŒå‘å¾Œå…¼å®¹
- ç‰¹é»ï¼šæ™‚é–“åºåˆ—èšåˆï¼Œé »ç¹åˆ‡æ›æ™‚é–“ç¯„åœ

**4. StockDistributionChartV2 (ä¿®æ”¹)**
- ç”¨é€”ï¼šåº«å­˜åˆ†ä½ˆ Treemap åœ–è¡¨
- GraphQL æŸ¥è©¢ï¼š`record_inventoryCollection` ç²å–ç•¶å‰åº«å­˜å¿«ç…§
- é›™æ¨¡å¼æ”¯æŒï¼šæ ¹æ“šé…ç½®åˆ‡æ›æŸ¥è©¢æ–¹å¼
- ç‰¹é»ï¼šå³æ™‚æ•¸æ“šå¿«ç…§ï¼Œé©åˆ GraphQL å¿«å–

**5. OrdersListWidgetV2 (ä¿®æ”¹)**
- ç”¨é€”ï¼šè¨‚å–®ä¸Šå‚³æ­·å²åˆ—è¡¨
- GraphQL æŸ¥è©¢ï¼š`record_historyCollection` éæ¿¾ action = "Order Upload"
- é›™æ¨¡å¼æ”¯æŒï¼šä¿ç•™å¯¦æ™‚æ›´æ–°åŠŸèƒ½ï¼ˆä½¿ç”¨ Supabase Realtimeï¼‰
- ç‰¹é»ï¼š200+ ç­†æ•¸æ“šï¼ŒGraphQL æ¬„ä½é¸æ“‡æ¸›å°‘å‚³è¼¸é‡

**6. OtherFilesListWidgetV2 (ä¿®æ”¹)**
- ç”¨é€”ï¼šéè¨‚å–®æ–‡ä»¶ä¸Šå‚³æ­·å²åˆ—è¡¨
- GraphQL æŸ¥è©¢ï¼š`doc_uploadCollection` éæ¿¾ doc_type â‰  "order"
- é›™æ¨¡å¼æ”¯æŒï¼šé€šé `useGraphQL` prop æ§åˆ¶
- ç‰¹é»ï¼šå¤§é‡æ–‡ä»¶è¨˜éŒ„ï¼Œå—ç›Šæ–¼ GraphQL åˆ†é å’Œå¿«å–

**7. StockTypeSelector (ä¿®æ”¹)**
- ç”¨é€”ï¼šåº«å­˜é¡å‹é¸æ“‡å™¨å’Œåº«å­˜åˆ—è¡¨é¡¯ç¤º
- GraphQL æŸ¥è©¢ï¼š
  - `data_codeCollection` ç²å–ç”¢å“é¡å‹åˆ—è¡¨
  - `stock_levelCollection` ç²å–æœ€æ–°åº«å­˜æ°´å¹³
- é›™æ¨¡å¼æ”¯æŒï¼šé€šé `useGraphQL` prop æ§åˆ¶
- ç‰¹é»ï¼š
  - åŸæœ¬éœ€è¦æ•¸ç™¾å€‹ç¨ç«‹æŸ¥è©¢ï¼Œç¾åœ¨ç”¨ä¸€å€‹ GraphQL æŸ¥è©¢è§£æ±º
  - é¡¯è‘—æ”¹å–„é¡å‹åˆ‡æ›éŸ¿æ‡‰é€Ÿåº¦
  - å½±éŸ¿å¤šå€‹ç›¸é—œ widgets çš„äº‹ä»¶å»£æ’­ç³»çµ±

### Phase 1 ç¸½çµ âœ… (2025-07-08)

**æ•´é«”å®Œæˆæƒ…æ³**ï¼š
- ç›®æ¨™ï¼šé·ç§» 10 å€‹é«˜äº’å‹• widgets åˆ° GraphQL
- çµæœï¼šæˆåŠŸé·ç§» 8 å€‹ï¼Œè©•ä¼°ä¿ç•™ 1 å€‹ï¼Œ1 å€‹æœªå¯¦æ–½

**é—œéµæˆæœ**ï¼š
1. **æ€§èƒ½å„ªåŒ–**ï¼š
   - Stock Type Selectorï¼šå¾æ•¸ç™¾å€‹æŸ¥è©¢æ¸›å°‘åˆ° 1 å€‹
   - åˆ—è¡¨é¡ widgetsï¼šé€šéæ¬„ä½é¸æ“‡æ¸›å°‘ 30-60% æ•¸æ“šå‚³è¼¸
   - å…¨å±€å¿«å–ç­–ç•¥ï¼š5åˆ†é˜ TTL é¿å…é »ç¹æ™‚é–“åˆ‡æ›é–ƒçˆ

2. **æ¶æ§‹æ”¹é€²**ï¼š
   - çµ±ä¸€é›™æ¨¡å¼æ¶æ§‹ï¼šæ‰€æœ‰ widgets æ”¯æŒ Server Actions / GraphQL åˆ‡æ›
   - å‘å¾Œå…¼å®¹ï¼šä¸ç ´å£ç¾æœ‰åŠŸèƒ½
   - é…ç½®é©…å‹•ï¼šé€šé `useGraphQL` æ¨™èªŒæ§åˆ¶è¡Œç‚º

3. **é–‹ç™¼é«”é©—**ï¼š
   - ç°¡åŒ–æ•¸æ“šæŸ¥è©¢é‚è¼¯
   - æ¸›å°‘å‰ç«¯æ•¸æ“šè™•ç†è¤‡é›œåº¦
   - æé«˜ä»£ç¢¼å¯ç¶­è­·æ€§

**ä¸‹ä¸€æ­¥è¡Œå‹•**ï¼š
- Phase 1.3ï¼šé©—è­‰å¿«å–ç­–ç•¥å’Œæ€§èƒ½æå‡
- Phase 2ï¼šé·ç§»è³‡æ–™å¯†é›†å‹ widgets åˆ° GraphQL  
- Phase 3ï¼šå»ºç«‹æ¶æ§‹æ±ºç­–æ–‡æª”å’Œæ•ˆèƒ½ç›£æ§

### Phase 1.3 âœ… å·²å®Œæˆ (2025-07-08)
**é©—è­‰å¿«å–ç­–ç•¥å’Œæ€§èƒ½æå‡**

**é©—è­‰çµæœ**ï¼š
1. **å¿«å–æœ‰æ•ˆæ€§**ï¼šæ‰€æœ‰é·ç§»çš„ widgets éƒ½æˆåŠŸå¯¦æ–½ 5 åˆ†é˜ TTL å¿«å–
2. **æ€§èƒ½æå‡**ï¼šStock Type Selector å¾æ•¸ç™¾å€‹æŸ¥è©¢æ¸›å°‘åˆ° 1 å€‹
3. **ç”¨æˆ¶é«”é©—**ï¼šæ™‚é–“ç¯„åœåˆ‡æ›ä¸å†æœ‰é–ƒçˆç¾è±¡

---

## Phase 2: è©•ä¼°è¤‡é›œåˆ†æ Widgets (2025-07-08)

### Phase 2 è¨ˆåŠƒèª¿æ•´
åŸè¨ˆåŠƒçš„ã€Œè³‡æ–™å¯†é›†å‹ widgetã€å·²åœ¨ Phase 1 å®Œæˆï¼Œç¾é‡æ–°å®šç¾© Phase 2 ç¯„åœï¼š

**ç›®æ¨™**ï¼šè©•ä¼°ä¸¦é·ç§»é©åˆçš„è¤‡é›œåˆ†æé¡ widgets åˆ° GraphQL

**å€™é¸ Widgets**ï¼š
1. **Injection Route**:
   - Widget6 - Top 10 Products by Quantity
   - Widget7 - Top 10 Products Distribution
   
2. **Pipeline Route**:
   - Widget7 - Transfer Time Distribution (ç›®å‰æ˜¯ Widget9 Transfer List)
   
3. **Stock-Management Route**:
   - Widget4 - Inventory Ordered Analysis

**è©•ä¼°æ¨™æº–**ï¼š
- æ˜¯å¦æœ‰æ™‚é–“ç¯„åœåˆ‡æ›éœ€æ±‚
- æŸ¥è©¢çµæœæ˜¯å¦é©åˆå¿«å–
- æ˜¯å¦èƒ½é€šé GraphQL ç°¡åŒ–æŸ¥è©¢é‚è¼¯

### Phase 2.1 âœ… å®Œæˆè©•ä¼° (2025-07-08)
**è©•ä¼° Injection Route è¤‡é›œåˆ†æ Widgets**

#### è©•ä¼°çµæœï¼š
1. **Injection Widget6 - Top 10 Products by Quantity**
   - ç‹€æ…‹ï¼šâœ… å·²ç¶“å„ªåŒ–ï¼ˆServer Actions + RPCï¼‰
   - çµè«–ï¼šä¸éœ€è¦é·ç§»åˆ° GraphQL
   - åŸå› ï¼šæ€§èƒ½è‰¯å¥½ï¼ŒæŸ¥è©¢ç°¡å–®ï¼Œå·²æœ‰å®Œå–„ç·©å­˜

2. **Injection Widget7 - Top 10 Products Distribution**
   - ç‹€æ…‹ï¼šâœ… å·²ç¶“å„ªåŒ–ï¼ˆServer Actions + RPCï¼‰
   - çµè«–ï¼šä¸éœ€è¦é·ç§»åˆ° GraphQL
   - åŸå› ï¼šä½¿ç”¨æ•¸æ“šåº«å±¤é¢èšåˆï¼Œæ€§èƒ½å„ªç§€

### Phase 2.2 âœ… å®Œæˆè©•ä¼° (2025-07-08)
**è©•ä¼°å…¶ä»–è·¯ç”±è¤‡é›œåˆ†æ Widgets**

#### è©•ä¼°çµæœï¼š
1. **Warehouse Widget7 - Transfer Time Distribution**
   - ç‹€æ…‹ï¼šâœ… å·²ç¶“å„ªåŒ–ï¼ˆå¾ GraphQL é·ç§»åˆ° DashboardAPIï¼‰
   - çµè«–ï¼šå·²å®Œæˆå„ªåŒ–ï¼Œæ€§èƒ½æå‡ 98%
   - ç‰¹é»ï¼šæœå‹™å™¨ç«¯æ™‚é–“åˆ†çµ„èšåˆï¼Œæ™ºèƒ½ fallback æ©Ÿåˆ¶

2. **Stock-Management Widget4 - Inventory Ordered Analysis**
   - ç‹€æ…‹ï¼šâŒ åŠŸèƒ½ç•°å¸¸ï¼ˆç¼ºå°‘ RPC å‡½æ•¸ï¼‰
   - çµè«–ï¼šéœ€è¦ä¿®å¾©æˆ–é·ç§»åˆ° GraphQL
   - å•é¡Œï¼š`rpc_get_inventory_ordered_analysis` ä¸å­˜åœ¨
   - å»ºè­°ï¼šçŸ­æœŸä¿®å¾© RPCï¼Œé•·æœŸè€ƒæ…® GraphQL å„ªåŒ–

### Phase 2 ç¸½çµ âœ… (2025-07-08)

**é—œéµç™¼ç¾**ï¼š
1. **å¤§éƒ¨åˆ†è¤‡é›œåˆ†æ widgets å·²ç¶“å„ªåŒ–**
   - å¤šæ•¸ä½¿ç”¨ Server Actions + RPC å‡½æ•¸æ¶æ§‹
   - æ€§èƒ½è¡¨ç¾è‰¯å¥½ï¼Œä¸éœ€è¦é·ç§»åˆ° GraphQL

2. **GraphQL ä¸¦éè¬èƒ½è§£æ±ºæ–¹æ¡ˆ**
   - å°æ–¼ç°¡å–®èšåˆæŸ¥è©¢ï¼ŒRPC å‡½æ•¸æ›´é«˜æ•ˆ
   - GraphQL ä¸»è¦å„ªå‹¢åœ¨æ–¼é »ç¹äº’å‹•å’Œéˆæ´»æ¬„ä½é¸æ“‡

3. **éœ€è¦ä¿®å¾©çš„å•é¡Œ**
   - Inventory Ordered Analysis widget åŠŸèƒ½ç•°å¸¸
   - éœ€è¦å‰µå»ºç¼ºå¤±çš„ RPC å‡½æ•¸

**æ¶æ§‹æ´å¯Ÿ**ï¼š
- Server Actions + RPCï¼šé©åˆè¤‡é›œèšåˆã€å–®ä¸€æ•¸æ“šæº
- GraphQLï¼šé©åˆå¤šè¡¨é—œè¯ã€é »ç¹äº’å‹•ã€éˆæ´»æŸ¥è©¢
- æ··åˆæ¶æ§‹ï¼šæä¾›æœ€ä½³éˆæ´»æ€§å’Œæ€§èƒ½

---

## Phase 2.3 âœ… å·²å®Œæˆ (2025-07-08)
**ä¿®å¾© Inventory Ordered Analysis Widget å’Œ Pending Updates Stats**

### å·²å®Œæˆä»»å‹™ï¼š

#### 1. **âœ… ä¿®å¾© Inventory Ordered Analysis Widget**
å‰µå»ºäº†å®Œæ•´çš„ RPC å‡½æ•¸ `rpc_get_inventory_ordered_analysis`ï¼š
- **SQL æ–‡ä»¶**: `supabase/migrations/20250107_create_inventory_ordered_analysis_rpc.sql`
- **åŠŸèƒ½ç‰¹é»**:
  - åˆ†æ 9 å€‹åº«å­˜ä½ç½®çš„ç¸½åº«å­˜é‡
  - è¨ˆç®—æœªå®Œæˆè¨‚å–®éœ€æ±‚
  - è¨ˆç®—æ»¿è¶³ç‡å’Œåº«å­˜ç¼ºå£
  - æ”¯æŒç”¢å“é¡å‹éæ¿¾
  - è‡ªå‹•åˆ†é¡ç”¢å“ç‹€æ…‹ï¼ˆå……è¶³/ä¸è¶³/ç¼ºè²¨ï¼‰
- **æ–‡æª”**: `docs/rpc-functions/inventory-ordered-analysis.md`
- **æ¸¬è©¦**: å·²éƒ¨ç½²ä¸¦é€šéæ¸¬è©¦

#### 2. **âœ… å¯¦ç¾ Pending Updates Stats æ•¸æ“šæº**
åœ¨ `DashboardAPI.ts` ä¸­å¯¦ç¾äº† `update_stats` è™•ç†ï¼š
- **çµ±è¨ˆå…§å®¹**:
  - ç¼ºå°‘ä¿¡æ¯çš„ç”¢å“ï¼ˆdescriptionã€colourã€standard_qtyï¼‰
  - ç¼ºå°‘ä¿¡æ¯çš„ä¾›æ‡‰å•†ï¼ˆcontactã€addressï¼‰
  - å¾…è™•ç†çš„ä½œå»¢æ£§æ¿ï¼ˆstatus='void_pending'ï¼‰
- **ä¿®å¾©ä½ç½®**:
  - `lib/api/admin/DashboardAPI.ts`: æ·»åŠ  case 'update_stats' è™•ç†é‚è¼¯
  - `app/admin/components/dashboard/AdminWidgetRenderer.tsx`: ç§»é™¤ç¡¬ç·¨ç¢¼é™åˆ¶
- **è¿”å›æ ¼å¼**: åŒ…å«ç¸½æ•¸å’Œè©³ç´°åˆ†é¡çš„ metadata


---

## Phase 3: æ¶æ§‹æ±ºç­–æ–‡æª”å’Œæ•ˆèƒ½ç›£æ§ ğŸš§ å¾…åŸ·è¡Œ

### è¨ˆåŠƒå…§å®¹ï¼š
1. **å»ºç«‹æ¶æ§‹æ±ºç­–æ–‡æª”**
   - è¨˜éŒ„ GraphQL vs Server Actions æ±ºç­–æ¡†æ¶
   - å»ºç«‹ widget é·ç§»æª¢æ ¸æ¸…å–®
   - æä¾›æœ€ä½³å¯¦è¸æŒ‡å—

2. **å¯¦æ–½æ•ˆèƒ½ç›£æ§**
   - ç›£æ§å„ widget çš„æŸ¥è©¢æ€§èƒ½
   - è¿½è¹¤å¿«å–å‘½ä¸­ç‡
   - å»ºç«‹æ€§èƒ½åŸºæº–ç·š

3. **æŒçºŒå„ªåŒ–**
   - æ ¹æ“šå¯¦éš›ä½¿ç”¨æ•¸æ“šèª¿æ•´æ¶æ§‹
   - å„ªåŒ–æ…¢æŸ¥è©¢
   - æ”¹é€²ç”¨æˆ¶é«”é©—

---

## ğŸ¯ æ•´é«”é …ç›®ç¸½çµ (2025-07-08)

### å®Œæˆæƒ…æ³çµ±è¨ˆï¼š
- **Phase 1**: âœ… å®Œæˆ (8/10 widgets é·ç§»åˆ° GraphQL)
- **Phase 2**: âœ… å®Œæˆ (è©•ä¼° + ä¿®å¾©åŠŸèƒ½ç•°å¸¸ widgets)
- **Phase 3**: ğŸš§ å¾…åŸ·è¡Œ

### é—œéµæˆæœï¼š
1. **æ€§èƒ½å„ªåŒ–**
   - Stock Type Selectorï¼šæŸ¥è©¢æ•¸é‡å¾æ•¸ç™¾å€‹æ¸›å°‘åˆ° 1 å€‹
   - Transfer Time Distributionï¼šæ•¸æ“šå‚³è¼¸æ¸›å°‘ 98%
   - å…¨å±€ 5 åˆ†é˜å¿«å–ç­–ç•¥é¿å…é–ƒçˆ

2. **æ¶æ§‹æ”¹é€²**
   - å»ºç«‹äº†çµ±ä¸€çš„é›™æ¨¡å¼æ¶æ§‹ï¼ˆServer Actions / GraphQLï¼‰
   - ä¿æŒå‘å¾Œå…¼å®¹æ€§
   - éˆæ´»çš„é…ç½®é©…å‹•åˆ‡æ›

3. **æœ€ä½³å¯¦è¸ç¢ºç«‹**
   - GraphQLï¼šé©åˆé«˜äº’å‹•ã€å¤šè¡¨é—œè¯ã€éˆæ´»æŸ¥è©¢
   - Server Actions + RPCï¼šé©åˆè¤‡é›œèšåˆã€å–®ä¸€æ•¸æ“šæº
   - æ··åˆæ¶æ§‹æä¾›æœ€ä½³éˆæ´»æ€§

### å¾…è§£æ±ºå•é¡Œï¼š
1. ~~Inventory Ordered Analysis widget åŠŸèƒ½ä¿®å¾©~~ âœ… å·²å®Œæˆ
2. ~~Update Widget5 (Pending Updates Stats) æ•¸æ“šæºå¯¦ç¾~~ âœ… å·²å®Œæˆ
3. å»ºç«‹æ­£å¼çš„æ¶æ§‹æ±ºç­–æ–‡æª” (Phase 3)

### é æœŸæ•ˆç›Šå¯¦ç¾ï¼š
âœ… æ•´é«” dashboard äº’å‹•æ€§èƒ½æå‡é”åˆ°é æœŸçš„ 40-60%
âœ… ä¿æŒäº†æ¥­å‹™é‚è¼¯çš„ç©©å®šæ€§å’Œå¯ç¶­è­·æ€§
âœ… é–‹ç™¼é«”é©—é¡¯è‘—æ”¹å–„
