#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# æª¢æŸ¥æ•æ„Ÿè³‡è¨Šæ¨¡å¼
echo "ğŸ” æª¢æŸ¥æ•æ„Ÿè³‡è¨Š..."

# å®šç¾©æ•æ„Ÿè³‡è¨Šæ¨¡å¼
PATTERNS=(
  "sk-proj-[a-zA-Z0-9]+"  # OpenAI API keys
  "eyJ[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+"  # JWT tokens
  "sbp_[a-zA-Z0-9]+"  # Supabase access tokens
  "re_[a-zA-Z0-9]+"  # Resend API keys
  "SUPABASE_SERVICE_ROLE_KEY"
  "OPENAI_API_KEY"
  "RESEND_API_KEY"
)

# æª¢æŸ¥æš«å­˜çš„æª”æ¡ˆ
for pattern in "${PATTERNS[@]}"; do
  if git diff --cached --name-only -z | xargs -0 grep -E "$pattern" 2>/dev/null; then
    echo "âŒ éŒ¯èª¤ï¼šç™¼ç¾æ•æ„Ÿè³‡è¨Šæ¨¡å¼: $pattern"
    echo "è«‹ç§»é™¤æ•æ„Ÿè³‡è¨Šå¾Œå†æäº¤"
    exit 1
  fi
done

echo "âœ… æ•æ„Ÿè³‡è¨Šæª¢æŸ¥é€šé"

# åŸ·è¡Œå…¶ä»–æª¢æŸ¥
npm run typecheck || exit 1